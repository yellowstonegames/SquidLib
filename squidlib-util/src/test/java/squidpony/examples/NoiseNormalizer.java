package squidpony.examples;
/*
 * Noise Normalizer
 *
 * Uses gradient ascent to attempt to determine the maximum value that a simplex-style coherent noise would generate,
 * so that you can go back and divide by it. And also, so you can re-test after you divide by it.
 * 
 * Configurable to different dimensionalities, kernel sizes, etc. I used this to generate the norms for SuperSimplex.
 * It might require some tweaking (which I may publish at some point) to provide the right lattice points for OpenSimplex.
 *
 * I also used this as practice with Java Streams, as you may notice. [NOTE: The streams have been removed.] And I left
 * a couple of commented code sections in in case they prove useful to you during troubleshooting.
 *
 * @author K.jpg
 */

import squidpony.ArrayTools;
import squidpony.squidmath.RNG;
import squidpony.squidmath.TangleRNG;

import java.util.Arrays;

public class NoiseNormalizer {
	
	// Number of dimensions
	// GRADIENTS should match
	// G (unskew factor) tends to differ as well
	public static int N = 3;
	
	// Unskew factor
	public static double G = 1.0;//-0.211324865405187;
	
	// Squared radius of kernel
	// for OpenSimplex2F
	public static double RADIUS_SQ = 0.5;
	// for OpenSimplex2S
//	public static double RADIUS_SQ = 2.0 / 3.0;

	public static double RATE = 1 / 32768d;
	
	public static double[][] GRADIENTS = new double[][] {
		
			/*{-2.22474487139,      -2.22474487139,      -1.0},
			{-2.22474487139,      -2.22474487139,       1.0},
			{-3.0862664687972017, -1.1721513422464978,  0.0},
			{-1.1721513422464978, -3.0862664687972017,  0.0},
			{-2.22474487139,      -1.0,                -2.22474487139},
			{-2.22474487139,       1.0,                -2.22474487139},
			{-1.1721513422464978,  0.0,                -3.0862664687972017},
			{-3.0862664687972017,  0.0,                -1.1721513422464978},
			{-2.22474487139,      -1.0,                 2.22474487139},
			{-2.22474487139,       1.0,                 2.22474487139},
			{-3.0862664687972017,  0.0,                 1.1721513422464978},
			{-1.1721513422464978,  0.0,                 3.0862664687972017},
			{-2.22474487139,       2.22474487139,      -1.0},
			{-2.22474487139,       2.22474487139,       1.0},
			{-1.1721513422464978,  3.0862664687972017,  0.0},
			{-3.0862664687972017,  1.1721513422464978,  0.0},
			{-1.0,                -2.22474487139,      -2.22474487139},
			{ 1.0,                -2.22474487139,      -2.22474487139},
			{ 0.0,                -3.0862664687972017, -1.1721513422464978},
			{ 0.0,                -1.1721513422464978, -3.0862664687972017},
			{-1.0,                -2.22474487139,       2.22474487139},
			{ 1.0,                -2.22474487139,       2.22474487139},
			{ 0.0,                -1.1721513422464978,  3.0862664687972017},
			{ 0.0,                -3.0862664687972017,  1.1721513422464978},
			{-1.0,                 2.22474487139,      -2.22474487139},
			{ 1.0,                 2.22474487139,      -2.22474487139},
			{ 0.0,                 1.1721513422464978, -3.0862664687972017},
			{ 0.0,                 3.0862664687972017, -1.1721513422464978},
			{-1.0,                 2.22474487139,       2.22474487139},
			{ 1.0,                 2.22474487139,       2.22474487139},
			{ 0.0,                 3.0862664687972017,  1.1721513422464978},
			{ 0.0,                 1.1721513422464978,  3.0862664687972017},
			{ 2.22474487139,      -2.22474487139,      -1.0},
			{ 2.22474487139,      -2.22474487139,       1.0},
			{ 1.1721513422464978, -3.0862664687972017,  0.0},
			{ 3.0862664687972017, -1.1721513422464978,  0.0},
			{ 2.22474487139,      -1.0,                -2.22474487139},
			{ 2.22474487139,       1.0,                -2.22474487139},
			{ 3.0862664687972017,  0.0,                -1.1721513422464978},
			{ 1.1721513422464978,  0.0,                -3.0862664687972017},
			{ 2.22474487139,      -1.0,                 2.22474487139},
			{ 2.22474487139,       1.0,                 2.22474487139},
			{ 1.1721513422464978,  0.0,                 3.0862664687972017},
			{ 3.0862664687972017,  0.0,                 1.1721513422464978},
			{ 2.22474487139,       2.22474487139,      -1.0},
			{ 2.22474487139,       2.22474487139,       1.0},
			{ 3.0862664687972017,  1.1721513422464978,  0.0},
			{ 1.1721513422464978,  3.0862664687972017,  0.0}*/
		
			/*{ 0.130526192220052,  0.99144486137381},
			{ 0.38268343236509,   0.923879532511287},
			{ 0.608761429008721,  0.793353340291235},
			{ 0.793353340291235,  0.608761429008721},
			{ 0.923879532511287,  0.38268343236509},
			{ 0.99144486137381,   0.130526192220051},
			{ 0.99144486137381,  -0.130526192220051},
			{ 0.923879532511287, -0.38268343236509},
			{ 0.793353340291235, -0.60876142900872},
			{ 0.608761429008721, -0.793353340291235},
			{ 0.38268343236509,  -0.923879532511287},
			{ 0.130526192220052, -0.99144486137381},
			{-0.130526192220052, -0.99144486137381},
			{-0.38268343236509,  -0.923879532511287},
			{-0.608761429008721, -0.793353340291235},
			{-0.793353340291235, -0.608761429008721},
			{-0.923879532511287, -0.38268343236509},
			{-0.99144486137381,  -0.130526192220052},
			{-0.99144486137381,   0.130526192220051},
			{-0.923879532511287,  0.38268343236509},
			{-0.793353340291235,  0.608761429008721},
			{-0.608761429008721,  0.793353340291235},
			{-0.38268343236509,   0.923879532511287},
			{-0.130526192220052,  0.99144486137381}*/
		
		
	  /*  { -0.763874, -0.596439, -0.246489 }, { 0.396055, 0.904518, -0.158073 }, { -0.499004, -0.8665, -0.0131631 }, { 0.468724, -0.824756, 0.316346 },
		{ 0.829598, 0.43195, 0.353816 }, { -0.454473, 0.629497, -0.630228 }, { -0.162349, -0.869962, -0.465628 }, { 0.932805, 0.253451, 0.256198 },
		{ -0.345419, 0.927299, -0.144227 }, { -0.715026, -0.293698, -0.634413 }, { -0.245997, 0.717467, -0.651711 }, { -0.967409, -0.250435, -0.037451 },
		{ 0.901729, 0.397108, -0.170852 }, { 0.892657, -0.0720622, -0.444938 }, { 0.0260084, -0.0361701, 0.999007 }, { 0.949107, -0.19486, 0.247439 },
		{ 0.471803, -0.807064, -0.355036 }, { 0.879737, 0.141845, 0.453809 }, { 0.570747, 0.696415, 0.435033 }, { -0.141751, -0.988233, -0.0574584 },
		{ -0.58219, -0.0303005, 0.812488 }, { -0.60922, 0.239482, -0.755975 }, { 0.299394, -0.197066, -0.933557 }, { -0.851615, -0.220702, -0.47544 },
		{ 0.848886, 0.341829, -0.403169 }, { -0.156129, -0.687241, 0.709453 }, { -0.665651, 0.626724, 0.405124 }, { 0.595914, -0.674582, 0.43569 },
		{ 0.171025, -0.509292, 0.843428 }, { 0.78605, 0.536414, -0.307222 }, { 0.18905, -0.791613, 0.581042 }, { -0.294916, 0.844994, 0.446105 },
		{ 0.342031, -0.58736, -0.7335 }, { 0.57155, 0.7869, 0.232635 }, { 0.885026, -0.408223, 0.223791 }, { -0.789518, 0.571645, 0.223347 },
		{ 0.774571, 0.31566, 0.548087 }, { -0.79695, -0.0433603, -0.602487 }, { -0.142425, -0.473249, -0.869339 }, { -0.0698838, 0.170442, 0.982886 },
		{ 0.687815, -0.484748, 0.540306 }, { 0.543703, -0.534446, -0.647112 }, { 0.97186, 0.184391, -0.146588 }, { 0.707084, 0.485713, -0.513921 },
		{ 0.942302, 0.331945, 0.043348 }, { 0.499084, 0.599922, 0.625307 }, { -0.289203, 0.211107, 0.9337 }, { 0.412433, -0.71667, -0.56239 },
		{ 0.87721, -0.082816, 0.47291 }, { -0.420685, -0.214278, 0.881538 }, { 0.752558, -0.0391579, 0.657361 }, { 0.0765725, -0.996789, 0.0234082 },
		{ -0.544312, -0.309435, -0.779727 }, { -0.455358, -0.415572, 0.787368 }, { -0.874586, 0.483746, 0.0330131 }, { 0.245172, -0.0838623, 0.965846 },
		{ 0.382293, -0.432813, 0.81641 }, { -0.287735, -0.905514, 0.311853 }, { -0.667704, 0.704955, -0.239186 }, { 0.717885, -0.464002, -0.518983 },
		{ 0.976342, -0.214895, 0.0240053 }, { -0.0733096, -0.921136, 0.382276 }, { -0.986284, 0.151224, -0.0661379 }, { -0.899319, -0.429671, 0.0812908 },
		{ 0.652102, -0.724625, 0.222893 }, { 0.203761, 0.458023, -0.865272 }, { -0.030396, 0.698724, -0.714745 }, { -0.460232, 0.839138, 0.289887 },
		{ -0.0898602, 0.837894, 0.538386 }, { -0.731595, 0.0793784, 0.677102 }, { -0.447236, -0.788397, 0.422386 }, { 0.186481, 0.645855, -0.740335 },
		{ -0.259006, 0.935463, 0.240467 }, { 0.445839, 0.819655, -0.359712 }, { 0.349962, 0.755022, -0.554499 }, { -0.997078, -0.0359577, 0.0673977 },
		{ -0.431163, -0.147516, -0.890133 }, { 0.299648, -0.63914, 0.708316 }, { 0.397043, 0.566526, -0.722084 }, { -0.502489, 0.438308, -0.745246 },
		{ 0.0687235, 0.354097, 0.93268 }, { -0.0476651, -0.462597, 0.885286 }, { -0.221934, 0.900739, -0.373383 }, { -0.956107, -0.225676, 0.186893 },
		{ -0.187627, 0.391487, -0.900852 }, { -0.224209, -0.315405, 0.92209 }, { -0.730807, -0.537068, 0.421283 }, { -0.0353135, -0.816748, 0.575913 },
		{ -0.941391, 0.176991, -0.287153 }, { -0.154174, 0.390458, 0.90762 }, { -0.283847, 0.533842, 0.796519 }, { -0.482737, -0.850448, 0.209052 },
		{ -0.649175, 0.477748, 0.591886 }, { 0.885373, -0.405387, -0.227543 }, { -0.147261, 0.181623, -0.972279 }, { 0.0959236, -0.115847, -0.988624 },
		{ -0.89724, -0.191348, 0.397928 }, { 0.903553, -0.428461, -0.00350461 }, { 0.849072, -0.295807, -0.437693 }, { 0.65551, 0.741754, -0.141804 },
		{ 0.61598, -0.178669, 0.767232 }, { 0.0112967, 0.932256, -0.361623 }, { -0.793031, 0.258012, 0.551845 }, { 0.421933, 0.454311, 0.784585 },
		{ -0.319993, 0.0401618, -0.946568 }, { -0.81571, 0.551307, -0.175151 }, { -0.377644, 0.00322313, 0.925945 }, { 0.129759, -0.666581, -0.734052 },
		{ 0.601901, -0.654237, -0.457919 }, { -0.927463, -0.0343576, -0.372334 }, { -0.438663, -0.868301, -0.231578 }, { -0.648845, -0.749138, -0.133387 },
		{ 0.507393, -0.588294, 0.629653 }, { 0.726958, 0.623665, 0.287358 }, { 0.411159, 0.367614, -0.834151 }, { 0.806333, 0.585117, -0.0864016 },
		{ 0.263935, -0.880876, 0.392932 }, { 0.421546, -0.201336, 0.884174 }, { -0.683198, -0.569557, -0.456996 }, { -0.117116, -0.0406654, -0.992285 },
		{ -0.643679, -0.109196, -0.757465 }, { -0.561559, -0.62989, 0.536554 }, { 0.0628422, 0.104677, -0.992519 }, { 0.480759, -0.2867, -0.828658 },
		{ -0.228559, -0.228965, -0.946222 }, { -0.10194, -0.65706, -0.746914 }, { 0.0689193, -0.678236, 0.731605 }, { 0.401019, -0.754026, 0.52022 },
		{ -0.742141, 0.547083, -0.387203 }, { -0.00210603, -0.796417, -0.604745 }, { 0.296725, -0.409909, -0.862513 }, { -0.260932, -0.798201, 0.542945 },
		{ -0.641628, 0.742379, 0.192838 }, { -0.186009, -0.101514, 0.97729 }, { 0.106711, -0.962067, 0.251079 }, { -0.743499, 0.30988, -0.592607 },
		{ -0.795853, -0.605066, -0.0226607 }, { -0.828661, -0.419471, -0.370628 }, { 0.0847218, -0.489815, -0.8677 }, { -0.381405, 0.788019, -0.483276 },
		{ 0.282042, -0.953394, 0.107205 }, { 0.530774, 0.847413, 0.0130696 }, { 0.0515397, 0.922524, 0.382484 }, { -0.631467, -0.709046, 0.313852 },
		{ 0.688248, 0.517273, 0.508668 }, { 0.646689, -0.333782, -0.685845 }, { -0.932528, -0.247532, -0.262906 }, { 0.630609, 0.68757, -0.359973 },
		{ 0.577805, -0.394189, 0.714673 }, { -0.887833, -0.437301, -0.14325 }, { 0.690982, 0.174003, 0.701617 }, { -0.866701, 0.0118182, 0.498689 },
		{ -0.482876, 0.727143, 0.487949 }, { -0.577567, 0.682593, -0.447752 }, { 0.373768, 0.0982991, 0.922299 }, { 0.170744, 0.964243, -0.202687 },
		{ 0.993654, -0.035791, -0.106632 }, { 0.587065, 0.4143, -0.695493 }, { -0.396509, 0.26509, -0.878924 }, { -0.0866853, 0.83553, -0.542563 },
		{ 0.923193, 0.133398, -0.360443 }, { 0.00379108, -0.258618, 0.965972 }, { 0.239144, 0.245154, -0.939526 }, { 0.758731, -0.555871, 0.33961 },
		{ 0.295355, 0.309513, 0.903862 }, { 0.0531222, -0.91003, -0.411124 }, { 0.270452, 0.0229439, -0.96246 }, { 0.563634, 0.0324352, 0.825387 },
		{ 0.156326, 0.147392, 0.976646 }, { -0.0410141, 0.981824, 0.185309 }, { -0.385562, -0.576343, -0.720535 }, { 0.388281, 0.904441, 0.176702 },
		{ 0.945561, -0.192859, -0.262146 }, { 0.844504, 0.520193, 0.127325 }, { 0.0330893, 0.999121, -0.0257505 }, { -0.592616, -0.482475, -0.644999 },
		{ 0.539471, 0.631024, -0.557476 }, { 0.655851, -0.027319, -0.754396 }, { 0.274465, 0.887659, 0.369772 }, { -0.123419, 0.975177, -0.183842 },
		{ -0.223429, 0.708045, 0.66989 }, { -0.908654, 0.196302, 0.368528 }, { -0.95759, -0.00863708, 0.288005 }, { 0.960535, 0.030592, 0.276472 },
		{ -0.413146, 0.907537, 0.0754161 }, { -0.847992, 0.350849, -0.397259 }, { 0.614736, 0.395841, 0.68221 }, { -0.503504, -0.666128, -0.550234 },
		{ -0.268833, -0.738524, -0.618314 }, { 0.792737, -0.60001, -0.107502 }, { -0.637582, 0.508144, -0.579032 }, { 0.750105, 0.282165, -0.598101 },
		{ -0.351199, -0.392294, -0.850155 }, { 0.250126, -0.960993, -0.118025 }, { -0.732341, 0.680909, -0.0063274 }, { -0.760674, -0.141009, 0.633634 },
		{ 0.222823, -0.304012, 0.926243 }, { 0.209178, 0.505671, 0.836984 }, { 0.757914, -0.56629, -0.323857 }, { -0.782926, -0.339196, 0.52151 },
		{ -0.462952, 0.585565, 0.665424 }, { 0.61879, 0.194119, -0.761194 }, { 0.741388, -0.276743, 0.611357 }, { 0.707571, 0.702621, 0.0752872 },
		{ 0.156562, 0.819977, 0.550569 }, { -0.793606, 0.440216, 0.42 }, { 0.234547, 0.885309, -0.401517 }, { 0.132598, 0.80115, -0.58359 },
		{ -0.377899, -0.639179, 0.669808 }, { -0.865993, -0.396465, 0.304748 }, { -0.624815, -0.44283, 0.643046 }, { -0.485705, 0.825614, -0.287146 },
		{ -0.971788, 0.175535, 0.157529 }, { -0.456027, 0.392629, 0.798675 }, { -0.0104443, 0.521623, -0.853112 }, { -0.660575, -0.74519, 0.091282 },
		{ -0.0157698, -0.307475, -0.951425 }, { -0.603467, -0.250192, 0.757121 }, { 0.506876, 0.25006, 0.824952 }, { 0.255404, 0.966794, 0.00884498 },
		{ 0.466764, -0.874228, -0.133625 }, { 0.475077, -0.0682351, -0.877295 }, { -0.224967, -0.938972, -0.260233 }, { -0.377929, -0.814757, -0.439705 },
		{ -0.305847, 0.542333, -0.782517 }, { 0.26658, -0.902905, -0.337191 }, { 0.0275773, 0.322158, -0.946284 }, { 0.0185422, 0.716349, 0.697496 },
		{ -0.20483, 0.978416, 0.0273371 }, { -0.898276, 0.373969, 0.230752 }, { -0.00909378, 0.546594, 0.837349 }, { 0.6602, -0.751089, 0.000959236 },
		{ 0.855301, -0.303056, 0.420259 }, { 0.797138, 0.0623013, -0.600574 }, { 0.48947, -0.866813, 0.0951509 }, { 0.251142, 0.674531, 0.694216 },
		{ -0.578422, -0.737373, -0.348867 }, { -0.254689, -0.514807, 0.818601 }, { 0.374972, 0.761612, 0.528529 }, { 0.640303, -0.734271, -0.225517 },
		{ -0.638076, 0.285527, 0.715075 }, { 0.772956, -0.15984, -0.613995 }, { 0.798217, -0.590628, 0.118356 }, { -0.986276, -0.0578337, -0.154644 },
		{ -0.312988, -0.94549, 0.0899272 }, { -0.497338, 0.178325, 0.849032 }, { -0.101136, -0.981014, 0.165477 }, { -0.521688, 0.0553434, -0.851339 },
		{ -0.786182, -0.583814, 0.202678 }, { -0.565191, 0.821858, -0.0714658 }, { 0.437895, 0.152598, -0.885981 }, { -0.92394, 0.353436, -0.14635 },
		{ 0.212189, -0.815162, -0.538969 }, { -0.859262, 0.143405, -0.491024 }, { 0.991353, 0.112814, 0.0670273 }, { 0.0337884, -0.979891, -0.196654 }*/
		
		/*{ -1, -1, 0 },
		{ 1, -1, 0 },
		{ -1, 1, 0 },
		{ 1, 1, 0 },
		{ -1, 0, -1 },
		{ 1, 0, -1 },
		{ -1, 0, 1 },
		{ 1, 0, 1 },
		{ 0, -1, -1 },
		{ 0, 1, -1 },
		{ 0, -1, 1 },
		{ 0, 1, 1 },*/
		
/*
		{                0.0,                 1.0},
		{                0.5,  0.8660254037844387},
		{ 0.8660254037844387,                 0.5},
		{                1.0,                 0.0},
		{ 0.8660254037844387,                -0.5},
		{                0.5, -0.8660254037844387},
		{                0.0,                -1.0},
		{               -0.5, -0.8660254037844387},
		{-0.8660254037844387,                -0.5},
		{               -1.0,                 0.0},
		{-0.8660254037844387,                 0.5},
		{               -0.5,  0.8660254037844387}
*/
			/*//used in OpenSimplex2S and 2F, from FastNoise
					{0.6499429579167653, 0.759982994187637},
					{-0.1551483029088119, 0.9878911904175052},
					{-0.8516180517334043, 0.5241628506120981},
					{-0.9518580082090311, -0.30653928330368374},
					{-0.38568876701087174, -0.9226289476282616},
					{0.4505066120763985, -0.8927730912586049},
					{0.9712959670388622, -0.23787421973396244},
					{0.8120673355833279, 0.5835637432865366},
					{0.08429892519436613, 0.9964405106232257},
					{-0.702488350003267, 0.7116952424385647},
					{-0.9974536374007479, -0.07131788861160528},
					{-0.5940875849508908, -0.804400361391775},
					{0.2252075529515288, -0.9743108118529653},
					{0.8868317111719171, -0.4620925405802277},
					{0.9275724981153959, 0.373643226540993},
					{0.3189067150428103, 0.9477861083074618},
					{-0.5130301507665112, 0.8583705868705491},
					{-0.9857873824221494, 0.1679977281313266},
					{-0.7683809836504446, -0.6399927061806058},
					{-0.013020236219374872, -0.9999152331316848},
					{0.7514561619680513, -0.6597830223946701},
					{0.9898275175279653, 0.14227257481477412},
					{0.5352066871710182, 0.8447211386057674},
					{-0.29411988281443646, 0.9557685360657266},
					{-0.9175289804081126, 0.39766892022290273},
					{-0.8985631161871687, -0.43884430750324743},
					{-0.2505005588110731, -0.968116454790094},
					{0.5729409678802212, -0.8195966369650838},
					{0.9952584535626074, -0.09726567026534665},
					{0.7207814785200723, 0.6931623620930514},
					{-0.05832476124070039, 0.998297662136006},
					{-0.7965970142012075, 0.6045107087270838},
					{-0.977160478114496, -0.21250270589112422},
					{-0.4736001288089817, -0.8807399831914728},
					{0.36153434093875386, -0.9323587937709286},
					{0.9435535266854258, -0.3312200813348966},
					{0.8649775992346886, 0.5018104750024599},
					{0.1808186720712497, 0.9835164502083277},
					{-0.6299339540895539, 0.7766487066139361},
					{-0.9996609468975833, 0.02603826506945166},
					{-0.6695112313914258, -0.7428019325774111},
					{0.12937272671950842, -0.9915960354807594},
					{0.8376810167470904, -0.5461597881403947},
					{0.959517028911149, 0.28165061908243916},
					{0.4095816551369482, 0.9122734610714476},
					{-0.42710760401484793, 0.9042008043530463},
					{-0.9647728141412515, 0.2630844295924223},
					{-0.8269869890664444, -0.562221059650754},
					{-0.11021592552380209, -0.9939076666174438},
					{0.6837188597775012, -0.72974551782423},
					{0.998972441738333, 0.04532174585508431},
					{0.6148313475439905, 0.7886586169422362},
					{-0.1997618324529528, 0.9798444827088829},
					{-0.8744989400706802, 0.48502742583822706},
					{-0.9369870231562731, -0.3493641630687752},
					{-0.3434772946489506, -0.9391609809082988},
					{0.4905057254335028, -0.8714379687143274},
					{0.9810787787756657, -0.1936089611460388},
					{0.7847847614201463, 0.6197684069414349},
					{0.03905187955516296, 0.9992371844077906},
					{-0.7340217731995672, 0.6791259356474049},
					{-0.9931964444524306, -0.1164509455824639},
					{-0.5570202966000876, -0.830498879695542},
					{0.2691336060685578, -0.9631028512493016},
					{0.9068632806061, -0.4214249521425399},
					{0.9096851999779008, 0.4152984913783901},
					{0.27562369868737335, 0.9612656119522284},
					{-0.5514058359842319, 0.8342371389734039},
					{-0.9923883787916933, 0.12314749546456379},
					{-0.7385858406439617, -0.6741594440488484},
					{0.032311046904542805, -0.9994778618098213},
					{0.7805865154410089, -0.6250477517051506},
					{0.9823623706068018, 0.18698709264487903},
					{0.49637249435561115, 0.8681096398768929},
					{-0.3371347561867868, 0.9414564016304079},
					{-0.9346092156607797, 0.35567627697379833},
					{-0.877750600058892, -0.47911781859606817},
					{-0.20636642697019966, -0.9784747813917093},
					{0.6094977881394418, -0.7927877687333024},
					{0.998644017504346, -0.052058873429796634},
					{0.6886255051458764, 0.7251171723677399},
					{-0.10350942208147358, 0.9946284731196666},
					{-0.8231759450656516, 0.567786371327519},
					{-0.9665253951623188, -0.2565709658288005},
					{-0.43319680340129196, -0.9012993562201753},
					{0.4034189716368784, -0.9150153732716426},
					{0.9575954428121146, -0.28811624026678895},
					{0.8413458575409575, 0.5404971304259356},
					{0.13605818775026976, 0.9907008476558967},
					{-0.664485735550556, 0.7473009482463117},
					{-0.999813836664718, -0.01929487014147803},
					{-0.6351581891853917, -0.7723820781910558},
					{0.17418065221630152, -0.984713714941304},
					{0.8615731658120597, -0.5076334109892543},
					{0.945766171482902, 0.32484819358982736},
					{0.3678149601703667, 0.9298990026206456},
					{-0.4676486851245607, 0.883914423064399},
					{-0.9757048995218635, 0.2190889067228882},
					{-0.8006563717736747, -0.5991238388999518},
					{-0.06505704156910719, -0.9978815467490495},
					{0.716089639712196, -0.6980083293893113},
					{0.9958918787052943, 0.09055035024139549},
					{0.5784561871098056, 0.8157134543418942},
					{-0.24396482815448167, 0.9697840804135497},
					{-0.8955826311865743, 0.4448952131872543},
					{-0.9201904205900768, -0.39147105876968413},
					{-0.3005599364234082, -0.9537629289384008},
					{0.5294967923694863, -0.84831193960148},
					{0.9888453593035162, -0.1489458135829932},
					{0.7558893631265085, 0.6546993743025888},
					{-0.006275422246980369, 0.9999803093439501},
					{-0.764046696121276, 0.6451609459244744},
					{-0.9868981170802014, -0.16134468229090512},
					{-0.5188082666339063, -0.8548906260290385},
					{0.31250655826478446, -0.9499156020623616},
					{0.9250311403279032, -0.3798912863223621},
					{0.889928392754896, 0.45610026942404636},
					{0.2317742435145519, 0.9727696027545563},
					{-0.5886483179573486, 0.8083892365475831},
					{-0.996949901406418, 0.0780441803450664},
					{-0.707272817672466, -0.7069407057042696},
					{0.07757592706207364, -0.9969864470194466},
					{0.8081126726681943, -0.5890279350532263},
					{0.9728783545459001, 0.23131733021125322},
					{0.4565181982253288, 0.8897140746830408},
					{-0.3794567783511009, 0.9252094645881026},
					{-0.9497687200714887, 0.31295267753091066},
					{-0.8551342041690687, -0.5184066867432686},
					{-0.16180818807538452, -0.9868222283024238},
					{0.6448020194233159, -0.7643496292585048},
					{0.9999772516247822, -0.006745089543285545},
					{0.6550543261176665, 0.7555817823601425},
					{-0.14848135899860646, 0.9889152066936411},
					{-0.848063153443784, 0.5298951667745091},
					{-0.9539039899003245, -0.300111942535184},
					{-0.3919032080850608, -0.9200064540494471},
					{0.44447452934057863, -0.8957914895596358},
					{0.9696693887216105, -0.24442028675267172},
					{0.8159850520735595, 0.5780730012658526},
					{0.0910180879994953, 0.9958492394217692},
					{-0.6976719213969089, 0.7164173993520435},
					{-0.9979119924958648, -0.06458835214597858},
					{-0.5994998228898376, -0.8003748886334786},
					{0.2186306161766729, -0.9758076929755208},
					{0.8836946816279001, -0.46806378802740584},
					{0.9300716543684309, 0.36737816720699407},
					{0.32529236260160294, 0.9456134933645286},
					{-0.5072286936943775, 0.8618114946396893},
					{-0.9846317976415725, 0.17464313062106204},
					{-0.7726803123417516, -0.6347953488483143},
					{-0.019764457813331488, -0.9998046640256011},
					{0.7469887719961158, -0.6648366525032559},
					{0.9907646418168752, 0.13559286310672486},
					{0.5408922318074902, 0.8410919055432124},
					{-0.2876664477065717, 0.9577306588304888},
					{-0.9148257956391065, 0.40384868903250853},
					{-0.9015027194859215, -0.4327734358292892},
					{-0.2570248925062563, -0.9664047830139022},
					{0.5673996816983953, -0.8234425306046317},
					{0.9945797473944409, -0.10397656501736473},
					{0.7254405241129018, 0.6882848581617921},
					{-0.05158982732517303, 0.9986683582233687},
					{-0.7925014140531963, 0.609870075281354},
					{-0.9785715990807187, -0.20590683687679034},
					{-0.47953002522651733, -0.8775254725113429},
					{0.35523727306945746, -0.9347761656258549},
					{0.9412979532686209, -0.33757689964259285},
					{0.868342678987353, 0.4959647082697184},
					{0.18744846526420056, 0.9822744386728669},
					{-0.6246810590458048, 0.7808800000444446},
					{-0.9994625758058275, 0.03278047534097766},
					{-0.674506266646887, -0.738269121834361},
					{0.12268137965007223, -0.9924461089082646},
					{0.8339780641890598, -0.5517975973592748},
					{0.9613949601033843, 0.2751721837101493},
					{0.41572570400265835, 0.9094900433932711},
					{-0.42099897262033487, 0.907061114287578},
					{-0.9629763390922247, 0.2695859238694348},
					{-0.8307604078465821, -0.5566301687427484},
					{-0.11691741449967302, -0.9931416405461567},
					{0.6787811074228051, -0.7343406622310046},
					{0.999255415972447, 0.03858255628819732},
					{0.6201369341201711, 0.7844935837468874},
					{-0.19314814942146824, 0.9811696042861612},
					{-0.8712074932224428, 0.4909149659086258},
					{-0.9393222007870077, -0.34303615422962713},
					{-0.3498042060103595, -0.9368228314134226},
					{0.4846166400948296, -0.8747266499559725},
					{0.9797505510481769, -0.20022202106859724},
					{0.7889473022428521, 0.6144608647291752},
					{0.045790935472179155, 0.9989510449609544},
					{-0.7294243101497431, 0.684061529222753},
					{-0.9939593229024027, -0.10974909756074072},
					{-0.562609414602539, -0.8267228354174018},
					{0.26263126874523307, -0.9648962724963078},
					{0.9040001019019392, -0.4275322394408211},
					{0.9124657316291773, 0.4091531358824348},
					{0.28210125132356934, 0.9593846381935018},
					{-0.5457662881946498, 0.8379374431723614},
					{-0.9915351626845509, 0.12983844253579577},
					{-0.7431163048326799, -0.6691622803863227},
					{0.02556874420628532, -0.9996730662170076},
					{0.7763527553119807, -0.6302986588273021},
					{0.9836012681423212, 0.1803567168386515},
					{0.5022166799422209, 0.8647418148718223},
					{-0.330776879188771, 0.9437089891455613},
					{-0.9321888864830543, 0.3619722087639923},
					{-0.8809623252471085, -0.47318641305008735},
					{-0.21296163248563432, -0.9770605626515961},
					{0.604136498566135, -0.7968808512571063},
					{0.9982701582127194, -0.05879363249495786},
					{0.6935008202914851, 0.7204558364362367},
					{-0.09679820929680796, 0.9953040272584711},
					{-0.8193274492343137, 0.5733258505694586},
					{-0.9682340024187017, -0.25004582891994304},
					{-0.4392662937408502, -0.8983569018954422},
					{0.39723793388455464, -0.9177156552457467},
					{0.9556302892322005, -0.2945687530984589},
					{0.8449724198323217, 0.5348098818484104},
					{0.14273745857559722, 0.9897605861618151},
					{-0.6594300077680133, 0.7517659641504648},
					{-0.9999212381512442, -0.01255059735959867},
					{-0.6403535266476091, -0.768080308893523},
					{0.16753470770767478, -0.9858661784001437},
					{0.8581295336101056, -0.5134332513054668},
					{0.9479357869928937, 0.31846152630759517},
					{0.37407884501651706, 0.9273969040875156},
					{-0.461675964944643, 0.8870486477034012},
					{-0.9742049295269273, 0.22566513972130173},
					{-0.8046793020829978, -0.5937097108850584},
					{-0.07178636201352963, -0.9974200309943962},
					{0.7113652211526822, -0.7028225395748172},
					{0.9964799940037152, 0.08383091047075403},
					{0.5839450884626246, 0.8117931594072332},
					{-0.23741799789097484, 0.9714075840127259},
					{-0.8925614000865144, 0.45092587758477687},
					{-0.9228099950981292, -0.38525538665538556},
					{-0.30698631553196837, -0.95171392869712},
					{0.5237628071845146, -0.8518641451605984},
					{0.9878182118285335, -0.15561227580071732},
					{0.7602881737752754, 0.6495859395164404},
					{4.6967723669845613E-4, 0.9999998897016406},
					{-0.7596776469502666, 0.6502998329417794},
					{-0.9879639510809196, -0.15468429579171308},
					{-0.5245627784110601, -0.8513717704420726},
					{0.3060921834538644, -0.9520018777441807},
					{0.9224476966294768, -0.3861220622846781},
					{0.8929845854878761, 0.45008724718774934},
					{0.23833038910266038, 0.9711841358002995},
					{-0.5831822693781987, 0.8123413326200348},
					{-0.9964008074312266, 0.0847669213219385},
					{-0.712025106726807, -0.7021540054650968},
					{0.07084939947717452, -0.9974870237721009},
					{0.8041212432524677, -0.5944653279629567},
					{0.9744164792492415, 0.22474991650168097},
					{0.462509014279733, 0.8866145790082576},
					*/
			//FastNoise 3D gradients
			{-0.448549002408981,  1.174316525459290,  0.000000000000001},
			{ 0.000000000000001,  1.069324374198914,  0.660878777503967},
			{ 0.448549002408981,  1.174316525459290,  0.000000000000001},
			{ 0.000000000000001,  1.069324374198914, -0.660878777503967},
			{-0.725767493247986,  0.725767493247986, -0.725767493247986},
			{-1.069324374198914,  0.660878777503967,  0.000000000000001},
			{-0.725767493247986,  0.725767493247986,  0.725767493247986},
			{ 0.725767493247986,  0.725767493247986,  0.725767493247986},
			{ 1.069324374198914,  0.660878777503967,  0.000000000000000},
			{ 0.725767493247986,  0.725767493247986, -0.725767493247986},
			{-0.660878777503967,  0.000000000000003, -1.069324374198914},
			{-1.174316525459290,  0.000000000000003, -0.448549002408981},
			{ 0.000000000000000,  0.448549002408981, -1.174316525459290},
			{-0.660878777503967,  0.000000000000001,  1.069324374198914},
			{ 0.000000000000001,  0.448549002408981,  1.174316525459290},
			{-1.174316525459290,  0.000000000000001,  0.448549002408981},
			{ 0.660878777503967,  0.000000000000001,  1.069324374198914},
			{ 1.174316525459290,  0.000000000000001,  0.448549002408981},
			{ 0.660878777503967,  0.000000000000001, -1.069324374198914},
			{ 1.174316525459290,  0.000000000000001, -0.448549002408981},
			{-0.725767493247986, -0.725767493247986, -0.725767493247986},
			{-1.069324374198914, -0.660878777503967, -0.000000000000001},
			{-0.000000000000001, -0.448549002408981, -1.174316525459290},
			{-0.000000000000001, -0.448549002408981,  1.174316525459290},
			{-0.725767493247986, -0.725767493247986,  0.725767493247986},
			{ 0.725767493247986, -0.725767493247986,  0.725767493247986},
			{ 1.069324374198914, -0.660878777503967,  0.000000000000001},
			{ 0.725767493247986, -0.725767493247986, -0.725767493247986},
			{-0.000000000000004, -1.069324374198914, -0.660878777503967},
			{-0.448549002408981, -1.174316525459290, -0.000000000000003},
			{-0.000000000000003, -1.069324374198914,  0.660878777503967},
			{ 0.448549002408981, -1.174316525459290,  0.000000000000003},

/* 		{-1.4082482904633333,    -1.4082482904633333,    -2.6329931618533333},
		{-0.07491495712999985,   -0.07491495712999985,   -3.29965982852},
		{ 0.24732126143473554,   -1.6667938651159684,    -2.838945207362466},
		{-1.6667938651159684,     0.24732126143473554,   -2.838945207362466},
		{-1.4082482904633333,    -2.6329931618533333,    -1.4082482904633333},
		{-0.07491495712999985,   -3.29965982852,         -0.07491495712999985},
		{-1.6667938651159684,    -2.838945207362466,      0.24732126143473554},
		{ 0.24732126143473554,   -2.838945207362466,     -1.6667938651159684},
		{ 1.5580782047233335,     0.33333333333333337,   -2.8914115380566665},
		{ 2.8914115380566665,    -0.33333333333333337,   -1.5580782047233335},
		{ 1.8101897177633992,    -1.2760767510338025,    -2.4482280932803},
		{ 2.4482280932803,        1.2760767510338025,    -1.8101897177633992},
		{ 1.5580782047233335,    -2.8914115380566665,     0.33333333333333337},
		{ 2.8914115380566665,    -1.5580782047233335,    -0.33333333333333337},
		{ 2.4482280932803,       -1.8101897177633992,     1.2760767510338025},
		{ 1.8101897177633992,    -2.4482280932803,       -1.2760767510338025},
		{-2.6329931618533333,    -1.4082482904633333,    -1.4082482904633333},
		{-3.29965982852,         -0.07491495712999985,   -0.07491495712999985},
		{-2.838945207362466,      0.24732126143473554,   -1.6667938651159684},
		{-2.838945207362466,     -1.6667938651159684,     0.24732126143473554},
		{ 0.33333333333333337,    1.5580782047233335,    -2.8914115380566665},
		{-0.33333333333333337,    2.8914115380566665,    -1.5580782047233335},
		{ 1.2760767510338025,     2.4482280932803,       -1.8101897177633992},
		{-1.2760767510338025,     1.8101897177633992,    -2.4482280932803},
		{ 0.33333333333333337,   -2.8914115380566665,     1.5580782047233335},
		{-0.33333333333333337,   -1.5580782047233335,     2.8914115380566665},
		{-1.2760767510338025,    -2.4482280932803,        1.8101897177633992},
		{ 1.2760767510338025,    -1.8101897177633992,     2.4482280932803},
		{ 3.29965982852,          0.07491495712999985,    0.07491495712999985},
		{ 2.6329931618533333,     1.4082482904633333,     1.4082482904633333},
		{ 2.838945207362466,     -0.24732126143473554,    1.6667938651159684},
		{ 2.838945207362466,      1.6667938651159684,    -0.24732126143473554},
		{-2.8914115380566665,     1.5580782047233335,     0.33333333333333337},
		{-1.5580782047233335,     2.8914115380566665,    -0.33333333333333337},
		{-2.4482280932803,        1.8101897177633992,    -1.2760767510338025},
		{-1.8101897177633992,     2.4482280932803,        1.2760767510338025},
		{-2.8914115380566665,     0.33333333333333337,    1.5580782047233335},
		{-1.5580782047233335,    -0.33333333333333337,    2.8914115380566665},
		{-1.8101897177633992,     1.2760767510338025,     2.4482280932803},
		{-2.4482280932803,       -1.2760767510338025,     1.8101897177633992},
		{ 0.07491495712999985,    3.29965982852,          0.07491495712999985},
		{ 1.4082482904633333,     2.6329931618533333,     1.4082482904633333},
		{ 1.6667938651159684,     2.838945207362466,     -0.24732126143473554},
		{-0.24732126143473554,    2.838945207362466,      1.6667938651159684},
		{ 0.07491495712999985,    0.07491495712999985,    3.29965982852},
		{ 1.4082482904633333,     1.4082482904633333,     2.6329931618533333},
		{-0.24732126143473554,    1.6667938651159684,     2.838945207362466},
		{ 1.6667938651159684,    -0.24732126143473554,    2.838945207362466} */
		
/*         { -0.753341017856078,     -0.37968289875261624,   -0.37968289875261624,   -0.37968289875261624 },
        { -0.7821684431180708,    -0.4321472685365301,    -0.4321472685365301,    0.12128480194602098 },
        { -0.7821684431180708,    -0.4321472685365301,    0.12128480194602098,    -0.4321472685365301 },
        { -0.7821684431180708,    0.12128480194602098,    -0.4321472685365301,    -0.4321472685365301 },
        { -0.8586508742123365,    -0.508629699630796,     0.044802370851755174,   0.044802370851755174 },
        { -0.8586508742123365,    0.044802370851755174,   -0.508629699630796,     0.044802370851755174 },
        { -0.8586508742123365,    0.044802370851755174,   0.044802370851755174,   -0.508629699630796 },
        { -0.9982828964265062,    -0.03381941603233842,   -0.03381941603233842,   -0.03381941603233842 },
        { -0.37968289875261624,   -0.753341017856078,     -0.37968289875261624,   -0.37968289875261624 },
        { -0.4321472685365301,    -0.7821684431180708,    -0.4321472685365301,    0.12128480194602098 },
        { -0.4321472685365301,    -0.7821684431180708,    0.12128480194602098,    -0.4321472685365301 },
        { 0.12128480194602098,    -0.7821684431180708,    -0.4321472685365301,    -0.4321472685365301 },
        { -0.508629699630796,     -0.8586508742123365,    0.044802370851755174,   0.044802370851755174 },
        { 0.044802370851755174,   -0.8586508742123365,    -0.508629699630796,     0.044802370851755174 },
        { 0.044802370851755174,   -0.8586508742123365,    0.044802370851755174,   -0.508629699630796 },
        { -0.03381941603233842,   -0.9982828964265062,    -0.03381941603233842,   -0.03381941603233842 },
        { -0.37968289875261624,   -0.37968289875261624,   -0.753341017856078,     -0.37968289875261624 },
        { -0.4321472685365301,    -0.4321472685365301,    -0.7821684431180708,    0.12128480194602098 },
        { -0.4321472685365301,    0.12128480194602098,    -0.7821684431180708,    -0.4321472685365301 },
        { 0.12128480194602098,    -0.4321472685365301,    -0.7821684431180708,    -0.4321472685365301 },
        { -0.508629699630796,     0.044802370851755174,   -0.8586508742123365,    0.044802370851755174 },
        { 0.044802370851755174,   -0.508629699630796,     -0.8586508742123365,    0.044802370851755174 },
        { 0.044802370851755174,   0.044802370851755174,   -0.8586508742123365,    -0.508629699630796 },
        { -0.03381941603233842,   -0.03381941603233842,   -0.9982828964265062,    -0.03381941603233842 },
        { -0.37968289875261624,   -0.37968289875261624,   -0.37968289875261624,   -0.753341017856078 },
        { -0.4321472685365301,    -0.4321472685365301,    0.12128480194602098,    -0.7821684431180708 },
        { -0.4321472685365301,    0.12128480194602098,    -0.4321472685365301,    -0.7821684431180708 },
        { 0.12128480194602098,    -0.4321472685365301,    -0.4321472685365301,    -0.7821684431180708 },
        { -0.508629699630796,     0.044802370851755174,   0.044802370851755174,   -0.8586508742123365 },
        { 0.044802370851755174,   -0.508629699630796,     0.044802370851755174,   -0.8586508742123365 },
        { 0.044802370851755174,   0.044802370851755174,   -0.508629699630796,     -0.8586508742123365 },
        { -0.03381941603233842,   -0.03381941603233842,   -0.03381941603233842,   -0.9982828964265062 },
        { -0.6740059517812944,    -0.3239847771997537,    -0.3239847771997537,    0.5794684678643381 },
        { -0.7504883828755602,    -0.4004672082940195,    0.15296486218853164,    0.5029860367700724 },
        { -0.7504883828755602,    0.15296486218853164,    -0.4004672082940195,    0.5029860367700724 },
        { -0.8828161875373585,    0.08164729285680945,    0.08164729285680945,    0.4553054119602712 },
        { -0.4553054119602712,    -0.08164729285680945,   -0.08164729285680945,   0.8828161875373585 },
        { -0.5029860367700724,    -0.15296486218853164,   0.4004672082940195,     0.7504883828755602 },
        { -0.5029860367700724,    0.4004672082940195,     -0.15296486218853164,   0.7504883828755602 },
        { -0.5794684678643381,    0.3239847771997537,     0.3239847771997537,     0.6740059517812944 },
        { -0.3239847771997537,    -0.6740059517812944,    -0.3239847771997537,    0.5794684678643381 },
        { -0.4004672082940195,    -0.7504883828755602,    0.15296486218853164,    0.5029860367700724 },
        { 0.15296486218853164,    -0.7504883828755602,    -0.4004672082940195,    0.5029860367700724 },
        { 0.08164729285680945,    -0.8828161875373585,    0.08164729285680945,    0.4553054119602712 },
        { -0.08164729285680945,   -0.4553054119602712,    -0.08164729285680945,   0.8828161875373585 },
        { -0.15296486218853164,   -0.5029860367700724,    0.4004672082940195,     0.7504883828755602 },
        { 0.4004672082940195,     -0.5029860367700724,    -0.15296486218853164,   0.7504883828755602 },
        { 0.3239847771997537,     -0.5794684678643381,    0.3239847771997537,     0.6740059517812944 },
        { -0.3239847771997537,    -0.3239847771997537,    -0.6740059517812944,    0.5794684678643381 },
        { -0.4004672082940195,    0.15296486218853164,    -0.7504883828755602,    0.5029860367700724 },
        { 0.15296486218853164,    -0.4004672082940195,    -0.7504883828755602,    0.5029860367700724 },
        { 0.08164729285680945,    0.08164729285680945,    -0.8828161875373585,    0.4553054119602712 },
        { -0.08164729285680945,   -0.08164729285680945,   -0.4553054119602712,    0.8828161875373585 },
        { -0.15296486218853164,   0.4004672082940195,     -0.5029860367700724,    0.7504883828755602 },
        { 0.4004672082940195,     -0.15296486218853164,   -0.5029860367700724,    0.7504883828755602 },
        { 0.3239847771997537,     0.3239847771997537,     -0.5794684678643381,    0.6740059517812944 },
        { -0.6740059517812944,    -0.3239847771997537,    0.5794684678643381,     -0.3239847771997537 },
        { -0.7504883828755602,    -0.4004672082940195,    0.5029860367700724,     0.15296486218853164 },
        { -0.7504883828755602,    0.15296486218853164,    0.5029860367700724,     -0.4004672082940195 },
        { -0.8828161875373585,    0.08164729285680945,    0.4553054119602712,     0.08164729285680945 },
        { -0.4553054119602712,    -0.08164729285680945,   0.8828161875373585,     -0.08164729285680945 },
        { -0.5029860367700724,    -0.15296486218853164,   0.7504883828755602,     0.4004672082940195 },
        { -0.5029860367700724,    0.4004672082940195,     0.7504883828755602,     -0.15296486218853164 },
        { -0.5794684678643381,    0.3239847771997537,     0.6740059517812944,     0.3239847771997537 },
        { -0.3239847771997537,    -0.6740059517812944,    0.5794684678643381,     -0.3239847771997537 },
        { -0.4004672082940195,    -0.7504883828755602,    0.5029860367700724,     0.15296486218853164 },
        { 0.15296486218853164,    -0.7504883828755602,    0.5029860367700724,     -0.4004672082940195 },
        { 0.08164729285680945,    -0.8828161875373585,    0.4553054119602712,     0.08164729285680945 },
        { -0.08164729285680945,   -0.4553054119602712,    0.8828161875373585,     -0.08164729285680945 },
        { -0.15296486218853164,   -0.5029860367700724,    0.7504883828755602,     0.4004672082940195 },
        { 0.4004672082940195,     -0.5029860367700724,    0.7504883828755602,     -0.15296486218853164 },
        { 0.3239847771997537,     -0.5794684678643381,    0.6740059517812944,     0.3239847771997537 },
        { -0.3239847771997537,    -0.3239847771997537,    0.5794684678643381,     -0.6740059517812944 },
        { -0.4004672082940195,    0.15296486218853164,    0.5029860367700724,     -0.7504883828755602 },
        { 0.15296486218853164,    -0.4004672082940195,    0.5029860367700724,     -0.7504883828755602 },
        { 0.08164729285680945,    0.08164729285680945,    0.4553054119602712,     -0.8828161875373585 },
        { -0.08164729285680945,   -0.08164729285680945,   0.8828161875373585,     -0.4553054119602712 },
        { -0.15296486218853164,   0.4004672082940195,     0.7504883828755602,     -0.5029860367700724 },
        { 0.4004672082940195,     -0.15296486218853164,   0.7504883828755602,     -0.5029860367700724 },
        { 0.3239847771997537,     0.3239847771997537,     0.6740059517812944,     -0.5794684678643381 },
        { -0.6740059517812944,    0.5794684678643381,     -0.3239847771997537,    -0.3239847771997537 },
        { -0.7504883828755602,    0.5029860367700724,     -0.4004672082940195,    0.15296486218853164 },
        { -0.7504883828755602,    0.5029860367700724,     0.15296486218853164,    -0.4004672082940195 },
        { -0.8828161875373585,    0.4553054119602712,     0.08164729285680945,    0.08164729285680945 },
        { -0.4553054119602712,    0.8828161875373585,     -0.08164729285680945,   -0.08164729285680945 },
        { -0.5029860367700724,    0.7504883828755602,     -0.15296486218853164,   0.4004672082940195 },
        { -0.5029860367700724,    0.7504883828755602,     0.4004672082940195,     -0.15296486218853164 },
        { -0.5794684678643381,    0.6740059517812944,     0.3239847771997537,     0.3239847771997537 },
        { -0.3239847771997537,    0.5794684678643381,     -0.6740059517812944,    -0.3239847771997537 },
        { -0.4004672082940195,    0.5029860367700724,     -0.7504883828755602,    0.15296486218853164 },
        { 0.15296486218853164,    0.5029860367700724,     -0.7504883828755602,    -0.4004672082940195 },
        { 0.08164729285680945,    0.4553054119602712,     -0.8828161875373585,    0.08164729285680945 },
        { -0.08164729285680945,   0.8828161875373585,     -0.4553054119602712,    -0.08164729285680945 },
        { -0.15296486218853164,   0.7504883828755602,     -0.5029860367700724,    0.4004672082940195 },
        { 0.4004672082940195,     0.7504883828755602,     -0.5029860367700724,    -0.15296486218853164 },
        { 0.3239847771997537,     0.6740059517812944,     -0.5794684678643381,    0.3239847771997537 },
        { -0.3239847771997537,    0.5794684678643381,     -0.3239847771997537,    -0.6740059517812944 },
        { -0.4004672082940195,    0.5029860367700724,     0.15296486218853164,    -0.7504883828755602 },
        { 0.15296486218853164,    0.5029860367700724,     -0.4004672082940195,    -0.7504883828755602 },
        { 0.08164729285680945,    0.4553054119602712,     0.08164729285680945,    -0.8828161875373585 },
        { -0.08164729285680945,   0.8828161875373585,     -0.08164729285680945,   -0.4553054119602712 },
        { -0.15296486218853164,   0.7504883828755602,     0.4004672082940195,     -0.5029860367700724 },
        { 0.4004672082940195,     0.7504883828755602,     -0.15296486218853164,   -0.5029860367700724 },
        { 0.3239847771997537,     0.6740059517812944,     0.3239847771997537,     -0.5794684678643381 },
        { 0.5794684678643381,     -0.6740059517812944,    -0.3239847771997537,    -0.3239847771997537 },
        { 0.5029860367700724,     -0.7504883828755602,    -0.4004672082940195,    0.15296486218853164 },
        { 0.5029860367700724,     -0.7504883828755602,    0.15296486218853164,    -0.4004672082940195 },
        { 0.4553054119602712,     -0.8828161875373585,    0.08164729285680945,    0.08164729285680945 },
        { 0.8828161875373585,     -0.4553054119602712,    -0.08164729285680945,   -0.08164729285680945 },
        { 0.7504883828755602,     -0.5029860367700724,    -0.15296486218853164,   0.4004672082940195 },
        { 0.7504883828755602,     -0.5029860367700724,    0.4004672082940195,     -0.15296486218853164 },
        { 0.6740059517812944,     -0.5794684678643381,    0.3239847771997537,     0.3239847771997537 },
        { 0.5794684678643381,     -0.3239847771997537,    -0.6740059517812944,    -0.3239847771997537 },
        { 0.5029860367700724,     -0.4004672082940195,    -0.7504883828755602,    0.15296486218853164 },
        { 0.5029860367700724,     0.15296486218853164,    -0.7504883828755602,    -0.4004672082940195 },
        { 0.4553054119602712,     0.08164729285680945,    -0.8828161875373585,    0.08164729285680945 },
        { 0.8828161875373585,     -0.08164729285680945,   -0.4553054119602712,    -0.08164729285680945 },
        { 0.7504883828755602,     -0.15296486218853164,   -0.5029860367700724,    0.4004672082940195 },
        { 0.7504883828755602,     0.4004672082940195,     -0.5029860367700724,    -0.15296486218853164 },
        { 0.6740059517812944,     0.3239847771997537,     -0.5794684678643381,    0.3239847771997537 },
        { 0.5794684678643381,     -0.3239847771997537,    -0.3239847771997537,    -0.6740059517812944 },
        { 0.5029860367700724,     -0.4004672082940195,    0.15296486218853164,    -0.7504883828755602 },
        { 0.5029860367700724,     0.15296486218853164,    -0.4004672082940195,    -0.7504883828755602 },
        { 0.4553054119602712,     0.08164729285680945,    0.08164729285680945,    -0.8828161875373585 },
        { 0.8828161875373585,     -0.08164729285680945,   -0.08164729285680945,   -0.4553054119602712 },
        { 0.7504883828755602,     -0.15296486218853164,   0.4004672082940195,     -0.5029860367700724 },
        { 0.7504883828755602,     0.4004672082940195,     -0.15296486218853164,   -0.5029860367700724 },
        { 0.6740059517812944,     0.3239847771997537,     0.3239847771997537,     -0.5794684678643381 },
        { 0.03381941603233842,    0.03381941603233842,    0.03381941603233842,    0.9982828964265062 },
        { -0.044802370851755174,  -0.044802370851755174,  0.508629699630796,      0.8586508742123365 },
        { -0.044802370851755174,  0.508629699630796,      -0.044802370851755174,  0.8586508742123365 },
        { -0.12128480194602098,   0.4321472685365301,     0.4321472685365301,     0.7821684431180708 },
        { 0.508629699630796,      -0.044802370851755174,  -0.044802370851755174,  0.8586508742123365 },
        { 0.4321472685365301,     -0.12128480194602098,   0.4321472685365301,     0.7821684431180708 },
        { 0.4321472685365301,     0.4321472685365301,     -0.12128480194602098,   0.7821684431180708 },
        { 0.37968289875261624,    0.37968289875261624,    0.37968289875261624,    0.753341017856078 },
        { 0.03381941603233842,    0.03381941603233842,    0.9982828964265062,     0.03381941603233842 },
        { -0.044802370851755174,  -0.044802370851755174,  0.8586508742123365,     0.508629699630796 },
        { -0.044802370851755174,  0.508629699630796,      0.8586508742123365,     -0.044802370851755174 },
        { -0.12128480194602098,   0.4321472685365301,     0.7821684431180708,     0.4321472685365301 },
        { 0.508629699630796,      -0.044802370851755174,  0.8586508742123365,     -0.044802370851755174 },
        { 0.4321472685365301,     -0.12128480194602098,   0.7821684431180708,     0.4321472685365301 },
        { 0.4321472685365301,     0.4321472685365301,     0.7821684431180708,     -0.12128480194602098 },
        { 0.37968289875261624,    0.37968289875261624,    0.753341017856078,      0.37968289875261624 },
        { 0.03381941603233842,    0.9982828964265062,     0.03381941603233842,    0.03381941603233842 },
        { -0.044802370851755174,  0.8586508742123365,     -0.044802370851755174,  0.508629699630796 },
        { -0.044802370851755174,  0.8586508742123365,     0.508629699630796,      -0.044802370851755174 },
        { -0.12128480194602098,   0.7821684431180708,     0.4321472685365301,     0.4321472685365301 },
        { 0.508629699630796,      0.8586508742123365,     -0.044802370851755174,  -0.044802370851755174 },
        { 0.4321472685365301,     0.7821684431180708,     -0.12128480194602098,   0.4321472685365301 },
        { 0.4321472685365301,     0.7821684431180708,     0.4321472685365301,     -0.12128480194602098 },
        { 0.37968289875261624,    0.753341017856078,      0.37968289875261624,    0.37968289875261624 },
        { 0.9982828964265062,     0.03381941603233842,    0.03381941603233842,    0.03381941603233842 },
        { 0.8586508742123365,     -0.044802370851755174,  -0.044802370851755174,  0.508629699630796 },
        { 0.8586508742123365,     -0.044802370851755174,  0.508629699630796,      -0.044802370851755174 },
        { 0.7821684431180708,     -0.12128480194602098,   0.4321472685365301,     0.4321472685365301 },
        { 0.8586508742123365,     0.508629699630796,      -0.044802370851755174,  -0.044802370851755174 },
        { 0.7821684431180708,     0.4321472685365301,     -0.12128480194602098,   0.4321472685365301 },
        { 0.7821684431180708,     0.4321472685365301,     0.4321472685365301,     -0.12128480194602098 },
        { 0.753341017856078,      0.37968289875261624,    0.37968289875261624,    0.37968289875261624 } */
	};


	// Rotate gradients for 3D OpenSimplex2 (BCC construction)
	static {
			for (int i = 0; i < GRADIENTS.length; i ++) {
				double gxr = GRADIENTS[i][0], gyr = GRADIENTS[i][1], gzr = GRADIENTS[i][2];			
				double grr = (2.0 / 3.0) * (gxr + gyr + gzr);
				double dx = grr - gxr, dy = grr - gyr, dz = grr - gzr;
				GRADIENTS[i][0] = dx; GRADIENTS[i][1] = dy; GRADIENTS[i][2] = dz;
			}
	}

	public static int sum(int[] arr){
		int s = 0;
		for (int i = 0; i < arr.length; i++) {
			s += arr[i];
		}
		return s;
	}

	public static void main(String[] args) { //0.030485933181293584 // 0.009837128628769433
		
		// Surrounding lattice points (no repeats)
		// NOTE: May need to be changed to provide the right points for OpenSimplex
		int nLatticePoints = (int)Math.pow(4, N);
		int[][] latticePointsCubespace = new int[nLatticePoints][];
		double[][] latticePoints = new double[nLatticePoints][];
		for (int k = 0; k < nLatticePoints; k++) {
			latticePointsCubespace[k] = ArrayTools.range(N);
			for (int i = 0; i < N; i++) {
				latticePointsCubespace[k][i] = ((k >> i * 2) & 3) - 1;
			}
			//latticePointsCubespace[k] = IntStream.range(0, N).map(i -> ((kk >> (i * 2)) & 3) - 1).toArray();
			//System.out.println(latticePointsCubespace[k][0]+","+latticePointsCubespace[k][1]+","+latticePointsCubespace[k][2]+","+latticePointsCubespace[k][3]);
		}
		for (int k = 0; k < nLatticePoints; k++) {
			double skew = G * sum(latticePointsCubespace[k]);
//			double skew = G * Arrays.stream(latticePointsCubespace[k]).sum();
			latticePoints[k] = new double[N];
			for (int i = 0; i < N; i++) {
				latticePoints[k][i] = latticePointsCubespace[k][i] + skew;
			}
//			latticePoints[k] = Arrays.stream(latticePointsCubespace[k]).mapToDouble(v -> v + skew).toArray();
		}
		
		double maxValue = 0;
		
//		java.util.Random random = new java.util.Random(); // this will have problems due to Marsaglia's Theorem

		RNG random = new RNG(new TangleRNG());

		while (true) {
			//double[] movingCoord = new double[] { random.nextDouble()*2-1, random.nextDouble()*2-1, random.nextDouble()*2-1 };
			double[] movingCoord = new double[] { random.nextDouble(), random.nextDouble(), random.nextDouble() };
			
			int[] latticePointGradientIndices = new int[nLatticePoints];
			double[] latticePointGradientDots = new double[nLatticePoints];
			double rate = RATE;
			int lastExponent = Integer.MAX_VALUE;
			while (true) {
				
				// Pick best gradients for current point
				for (int k = 0; k < nLatticePoints; k++) {
					double[] latticePoint = latticePoints[k];
					double currentBestDot = Double.NEGATIVE_INFINITY;
					int currentBestGradientIndex = -1;
					for (int j = 0; j < GRADIENTS.length; j++) {
						double[] currentGradient = GRADIENTS[j];

						double dot = 0.0;
						for (int i = 0; i < N; i++) {
							dot += (movingCoord[i] - latticePoint[i]) * currentGradient[i];
						}
//						double dot = IntStream.range(0, N).mapToDouble(i -> (movingCoord[i] - latticePoint[i]) * currentGradient[i]).sum();
						if (dot > currentBestDot) {
							currentBestGradientIndex = j;
							currentBestDot = dot;
						}
					}
					latticePointGradientIndices[k] = currentBestGradientIndex;
					latticePointGradientDots[k] = currentBestDot;
				}
				
				// Get value and gradient direction at current point
				double currentValue = 0;
				double[] currentDerivative = new double[N];
				for (int k = 0; k < nLatticePoints; k++) {
					double[] latticePoint = latticePoints[k];
					double[] gradient = GRADIENTS[latticePointGradientIndices[k]];
					double dot = latticePointGradientDots[k];
					double attn = RADIUS_SQ;
					for (int i = 0; i < N; i++) {
						attn -= (movingCoord[i] - latticePoint[i]) * (movingCoord[i] - latticePoint[i]);
					}
//					double attn = RADIUS_SQ - IntStream.range(0, N).mapToDouble(i -> (movingCoord[i] - latticePoint[i])).map(v -> v * v).sum();
					if (attn > 0) {
						double attnSq = attn * attn;
						double thisValue = attnSq * attnSq * dot;
						currentValue += thisValue;
						
						double dAttnMultiplier = -8 * attnSq * attn;
						double[] thisDerivative = new double[N];
						for (int i = 0; i < N; i++) {
							thisDerivative[i] = dAttnMultiplier * (movingCoord[i] - latticePoint[i]) * dot + attnSq * attnSq * gradient[i];
						}
//						double[] thisDerivative = IntStream.range(0, N).mapToDouble(i -> dAttnMultiplier * (movingCoord[i] - latticePoint[i]) * dot + attnSq * attnSq * gradient[i]).toArray();
						for (int l = 0; l < N; l++) currentDerivative[l] += thisDerivative[l];
					}
					
				}
				if (currentValue > maxValue) maxValue = currentValue;
				
				double currentDerivativeMagnitudeSq = 0.0;
				for (int i = 0; i < currentDerivative.length; i++) {
					currentDerivativeMagnitudeSq += currentDerivative[i] * currentDerivative[i];
				}
//				double curentDerivativeMagnitudeSq = Arrays.stream(currentDerivative).map(v -> v * v).sum();
				/*if (previousValue > currentValue) {
					rate /= (1+1/64d);
				}*/
				if (currentDerivativeMagnitudeSq > 0) {// 1/65536d/65536d/65536d/65536d/65536d/65536d) {
					double rateToTry = rate;
					double rateToStopAt = rate * 4;
					boolean changedWithoutPrecisionLossMakingItZero = false;
					while (true) {
						for (int l = 0; l < N; l++) {
							double newValue = movingCoord[l] + currentDerivative[l] * rateToTry;
							if (newValue > 1) newValue = 1; else if (newValue < -1) newValue = -1; else // TODO this is for P
							if (newValue != movingCoord[l]) changedWithoutPrecisionLossMakingItZero = true;
							movingCoord[l] = newValue;
						}
						if (Math.getExponent(currentDerivativeMagnitudeSq) < lastExponent) {
							lastExponent = Math.getExponent(currentDerivativeMagnitudeSq);
							System.out.println("Moving by lengths like: " + Math.sqrt(currentDerivativeMagnitudeSq) + ", current value: " + currentValue + ", current max value: " + maxValue);
						}
						if (changedWithoutPrecisionLossMakingItZero) break; // So we can continue
						if (rate >= rateToStopAt) {
							System.out.println("Change not big enough to not lose all precision, or something.");
							break;
						}
						rate *= 2;
					}
					if (changedWithoutPrecisionLossMakingItZero) continue;
				}
				System.out.println("Max value found: " + maxValue);
				System.out.println("Near location " + Arrays.toString(movingCoord));
				System.out.println("Which had gradient indices " + Arrays.toString(latticePointGradientIndices));
				System.out.println("And derivative " + Arrays.toString(currentDerivative));
				break;
				
			}
		}
	}
}