<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>Source code</title>
<meta name="description" content="source: package: squidpony.squidgrid.mapping, class: WildMap">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body class="source">
<main role="main">
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a id="line.1">package squidpony.squidgrid.mapping;</a>
<span class="sourceLineNo">002</span><a id="line.2"></a>
<span class="sourceLineNo">003</span><a id="line.3">import squidpony.ArrayTools;</a>
<span class="sourceLineNo">004</span><a id="line.4">import squidpony.FakeLanguageGen;</a>
<span class="sourceLineNo">005</span><a id="line.5">import squidpony.Thesaurus;</a>
<span class="sourceLineNo">006</span><a id="line.6">import squidpony.annotation.Beta;</a>
<span class="sourceLineNo">007</span><a id="line.7">import squidpony.squidgrid.Direction;</a>
<span class="sourceLineNo">008</span><a id="line.8">import squidpony.squidmath.BlueNoise;</a>
<span class="sourceLineNo">009</span><a id="line.9">import squidpony.squidmath.IRNG;</a>
<span class="sourceLineNo">010</span><a id="line.10">import squidpony.squidmath.IStatefulRNG;</a>
<span class="sourceLineNo">011</span><a id="line.11">import squidpony.squidmath.SilkRNG;</a>
<span class="sourceLineNo">012</span><a id="line.12"></a>
<span class="sourceLineNo">013</span><a id="line.13">import java.io.Serializable;</a>
<span class="sourceLineNo">014</span><a id="line.14">import java.util.ArrayList;</a>
<span class="sourceLineNo">015</span><a id="line.15"></a>
<span class="sourceLineNo">016</span><a id="line.16">import static squidpony.Maker.makeList;</a>
<span class="sourceLineNo">017</span><a id="line.17"></a>
<span class="sourceLineNo">018</span><a id="line.18">/**</a>
<span class="sourceLineNo">019</span><a id="line.19"> * A finite 2D area map for some kind of wilderness, adapting to different ecosystems by changing its output.</a>
<span class="sourceLineNo">020</span><a id="line.20"> * Regional maps for wilderness areas have very different requirements from mostly-artificial dungeons. This is intended</a>
<span class="sourceLineNo">021</span><a id="line.21"> * to work alongside {@link WorldMapGenerator} and {@link WorldMapGenerator.DetailedBiomeMapper} to produce, for</a>
<span class="sourceLineNo">022</span><a id="line.22"> * example, very sparse maps with an occasional cactus in a desert, or very dense maps with many trees and shrubs for a</a>
<span class="sourceLineNo">023</span><a id="line.23"> * forest.</a>
<span class="sourceLineNo">024</span><a id="line.24"> * &lt;br&gt;</a>
<span class="sourceLineNo">025</span><a id="line.25"> * Using this code mostly involves constructing a WildMap with a width, height, biome, and optionally a random number</a>
<span class="sourceLineNo">026</span><a id="line.26"> * generator, an ArrayList of floor types (as Strings) that can appear, and an ArrayList of terrain content that can</a>
<span class="sourceLineNo">027</span><a id="line.27"> * appear (also as Strings). Then you can call {@link #generate()}, which assigns indices into {@link #content} and</a>
<span class="sourceLineNo">028</span><a id="line.28"> * {@link #floors}, where an index can look up a value from {@link #contentTypes} or {@link #floorTypes}. The biome is</a>
<span class="sourceLineNo">029</span><a id="line.29"> * usually an index into {@link squidpony.squidgrid.mapping.WorldMapGenerator.DetailedBiomeMapper#biomeTable}, but can</a>
<span class="sourceLineNo">030</span><a id="line.30"> * be some other index if you don't use DetailedBiomeMapper (you would probably use a subclass then). The</a>
<span class="sourceLineNo">031</span><a id="line.31"> * {@link #contentTypes} field is an ArrayList; you can have and are encouraged to have duplicates when an object should</a>
<span class="sourceLineNo">032</span><a id="line.32"> * appear more often. An index of -1 in content indicates nothing of note is present there. There is also a String array</a>
<span class="sourceLineNo">033</span><a id="line.33"> * of {@link #floorTypes} that is not typically user-set unless you subclass WildMap yourself; it is used to look up the</a>
<span class="sourceLineNo">034</span><a id="line.34"> * indices in {@link #floors}. The floors are set to reasonable values for the particular biome, so a forest has "dirt"</a>
<span class="sourceLineNo">035</span><a id="line.35"> * and "leaves" among others, while a desert might only have "sand". Again, only the indices matter, so you could change</a>
<span class="sourceLineNo">036</span><a id="line.36"> * the values in {@link #floorTypes} to match names of textures in a graphical game and make lookup easier, or to a char</a>
<span class="sourceLineNo">037</span><a id="line.37"> * followed by the name of a color (as in SColor in the display module) for a text-based game.</a>
<span class="sourceLineNo">038</span><a id="line.38"> * &lt;br&gt;</a>
<span class="sourceLineNo">039</span><a id="line.39"> * This is marked Beta because there's still some work to be done, and the actual output will change even if the API</a>
<span class="sourceLineNo">040</span><a id="line.40"> * doesn't have any breaks. While the wilderness maps this produces are usable, they don't have paths or areas that a</a>
<span class="sourceLineNo">041</span><a id="line.41"> * character would have to find a way around (like a cliff). This is meant to be added at some point, probably in</a>
<span class="sourceLineNo">042</span><a id="line.42"> * conjunction with some system for connecting WildMaps.</a>
<span class="sourceLineNo">043</span><a id="line.43"> * &lt;br&gt;</a>
<span class="sourceLineNo">044</span><a id="line.44"> * Created by Tommy Ettinger on 10/16/2019.</a>
<span class="sourceLineNo">045</span><a id="line.45"> */</a>
<span class="sourceLineNo">046</span><a id="line.46">@Beta</a>
<span class="sourceLineNo">047</span><a id="line.47">public class WildMap implements Serializable {</a>
<span class="sourceLineNo">048</span><a id="line.48">    private static final long serialVersionUID = 1L;</a>
<span class="sourceLineNo">049</span><a id="line.49">    public final int width, height;</a>
<span class="sourceLineNo">050</span><a id="line.50">    public int biome;</a>
<span class="sourceLineNo">051</span><a id="line.51">    public IStatefulRNG rng;</a>
<span class="sourceLineNo">052</span><a id="line.52">    public ArrayList&lt;String&gt; contentTypes;</a>
<span class="sourceLineNo">053</span><a id="line.53">    public ArrayList&lt;String&gt; floorTypes;</a>
<span class="sourceLineNo">054</span><a id="line.54">    public final int[][] content, floors;</a>
<span class="sourceLineNo">055</span><a id="line.55"></a>
<span class="sourceLineNo">056</span><a id="line.56">    /**</a>
<span class="sourceLineNo">057</span><a id="line.57">     * Meant for generating large ArrayLists of Strings where an individual String may occur quite a few times.</a>
<span class="sourceLineNo">058</span><a id="line.58">     * The rest parameter is a vararg (it may also be an Object array) of alternating String and Integer values, where</a>
<span class="sourceLineNo">059</span><a id="line.59">     * an Integer is how many times to repeat the preceding String in the returned ArrayList.</a>
<span class="sourceLineNo">060</span><a id="line.60">     * @param rest a vararg (or Object array) of alternating String and Integer values</a>
<span class="sourceLineNo">061</span><a id="line.61">     * @return an ArrayList of Strings, probably with some or most of them repeated; you may want to shuffle this result</a>
<span class="sourceLineNo">062</span><a id="line.62">     */</a>
<span class="sourceLineNo">063</span><a id="line.63">    public static ArrayList&lt;String&gt; makeRepeats(Object... rest)</a>
<span class="sourceLineNo">064</span><a id="line.64">    {</a>
<span class="sourceLineNo">065</span><a id="line.65">        if(rest == null || rest.length &lt; 2)</a>
<span class="sourceLineNo">066</span><a id="line.66">        {</a>
<span class="sourceLineNo">067</span><a id="line.67">            return new ArrayList&lt;&gt;(0);</a>
<span class="sourceLineNo">068</span><a id="line.68">        }</a>
<span class="sourceLineNo">069</span><a id="line.69">        ArrayList&lt;String&gt; al = new ArrayList&lt;&gt;(rest.length);</a>
<span class="sourceLineNo">070</span><a id="line.70"></a>
<span class="sourceLineNo">071</span><a id="line.71">        for (int i = 0; i &lt; rest.length - 1; i+=2) {</a>
<span class="sourceLineNo">072</span><a id="line.72">            try {</a>
<span class="sourceLineNo">073</span><a id="line.73">                int count = (int)rest[i+1];</a>
<span class="sourceLineNo">074</span><a id="line.74">                String v = (String) rest[i];</a>
<span class="sourceLineNo">075</span><a id="line.75">                for (int j = 0; j &lt; count; j++) {</a>
<span class="sourceLineNo">076</span><a id="line.76">                    al.add(v);</a>
<span class="sourceLineNo">077</span><a id="line.77">                }</a>
<span class="sourceLineNo">078</span><a id="line.78">            }catch (ClassCastException ignored) {</a>
<span class="sourceLineNo">079</span><a id="line.79">            }</a>
<span class="sourceLineNo">080</span><a id="line.80">        }</a>
<span class="sourceLineNo">081</span><a id="line.81">        return al;</a>
<span class="sourceLineNo">082</span><a id="line.82">    }</a>
<span class="sourceLineNo">083</span><a id="line.83">    public static ArrayList&lt;String&gt; makeShuffledRepeats(IRNG rng, Object... rest) </a>
<span class="sourceLineNo">084</span><a id="line.84">    {</a>
<span class="sourceLineNo">085</span><a id="line.85">        ArrayList&lt;String&gt; al = makeRepeats(rest);</a>
<span class="sourceLineNo">086</span><a id="line.86">        rng.shuffleInPlace(al);</a>
<span class="sourceLineNo">087</span><a id="line.87">        return al;</a>
<span class="sourceLineNo">088</span><a id="line.88">    }</a>
<span class="sourceLineNo">089</span><a id="line.89">    public static ArrayList&lt;String&gt; makeVegetation(IRNG rng, int size, double monoculture, FakeLanguageGen naming)</a>
<span class="sourceLineNo">090</span><a id="line.90">    {</a>
<span class="sourceLineNo">091</span><a id="line.91">        Thesaurus t = new Thesaurus(rng);</a>
<span class="sourceLineNo">092</span><a id="line.92">        ArrayList&lt;String&gt; al = new ArrayList&lt;&gt;(size);</a>
<span class="sourceLineNo">093</span><a id="line.93">        String latest;</a>
<span class="sourceLineNo">094</span><a id="line.94">        for (int i = size; i &gt; 0; i--) {</a>
<span class="sourceLineNo">095</span><a id="line.95">            al.add(latest = t.makePlantName(naming));</a>
<span class="sourceLineNo">096</span><a id="line.96">            for (double j = rng.nextDouble(monoculture * 2.0 * size); j &gt;= 1 &amp;&amp; i &gt; 0; j--, i--) {</a>
<span class="sourceLineNo">097</span><a id="line.97">                al.add(latest);</a>
<span class="sourceLineNo">098</span><a id="line.98">            }</a>
<span class="sourceLineNo">099</span><a id="line.99">        }</a>
<span class="sourceLineNo">100</span><a id="line.100">        rng.shuffleInPlace(al);</a>
<span class="sourceLineNo">101</span><a id="line.101">        return al;</a>
<span class="sourceLineNo">102</span><a id="line.102">    }</a>
<span class="sourceLineNo">103</span><a id="line.103"></a>
<span class="sourceLineNo">104</span><a id="line.104">    /**</a>
<span class="sourceLineNo">105</span><a id="line.105">     * Gets a list of Strings that are really just the names of types of floor tile for wilderness areas.</a>
<span class="sourceLineNo">106</span><a id="line.106">     * @param biome an index into {@link squidpony.squidgrid.mapping.WorldMapGenerator.DetailedBiomeMapper#biomeTable}, or some other index if you don't use DetailedBiomeMapper</a>
<span class="sourceLineNo">107</span><a id="line.107">     * @param rng an IRNG, like {@link squidpony.squidmath.RNG} or {@link squidpony.squidmath.GWTRNG} </a>
<span class="sourceLineNo">108</span><a id="line.108">     * @return a shuffled ArrayList that typically contains repeats of the kinds of floor that can appear here</a>
<span class="sourceLineNo">109</span><a id="line.109">     */</a>
<span class="sourceLineNo">110</span><a id="line.110">    public static ArrayList&lt;String&gt; floorsByBiome(int biome, IRNG rng) {</a>
<span class="sourceLineNo">111</span><a id="line.111">        biome &amp;= 1023;</a>
<span class="sourceLineNo">112</span><a id="line.112">        switch (biome) {</a>
<span class="sourceLineNo">113</span><a id="line.113">            case 0: //Ice</a>
<span class="sourceLineNo">114</span><a id="line.114">            case 1:</a>
<span class="sourceLineNo">115</span><a id="line.115">            case 6:</a>
<span class="sourceLineNo">116</span><a id="line.116">            case 12:</a>
<span class="sourceLineNo">117</span><a id="line.117">            case 18:</a>
<span class="sourceLineNo">118</span><a id="line.118">            case 24:</a>
<span class="sourceLineNo">119</span><a id="line.119">            case 30:</a>
<span class="sourceLineNo">120</span><a id="line.120">            case 42:</a>
<span class="sourceLineNo">121</span><a id="line.121">            case 48:</a>
<span class="sourceLineNo">122</span><a id="line.122">                return makeShuffledRepeats(rng, "snow", 3, "ice", 1);</a>
<span class="sourceLineNo">123</span><a id="line.123">            case 7: //Tundra</a>
<span class="sourceLineNo">124</span><a id="line.124">            case 13:</a>
<span class="sourceLineNo">125</span><a id="line.125">            case 19:</a>
<span class="sourceLineNo">126</span><a id="line.126">            case 25:</a>
<span class="sourceLineNo">127</span><a id="line.127">                return makeShuffledRepeats(rng, "dirt", 6, "pebbles", 1, "snow", 9, "dry grass", 4);</a>
<span class="sourceLineNo">128</span><a id="line.128">            case 26: //BorealForest</a>
<span class="sourceLineNo">129</span><a id="line.129">            case 31:</a>
<span class="sourceLineNo">130</span><a id="line.130">            case 32:</a>
<span class="sourceLineNo">131</span><a id="line.131">                return makeShuffledRepeats(rng, "dirt", 3, "pebbles", 1, "snow", 11);</a>
<span class="sourceLineNo">132</span><a id="line.132">            case 43: //River</a>
<span class="sourceLineNo">133</span><a id="line.133">            case 44:</a>
<span class="sourceLineNo">134</span><a id="line.134">            case 45:</a>
<span class="sourceLineNo">135</span><a id="line.135">            case 46:</a>
<span class="sourceLineNo">136</span><a id="line.136">            case 47:</a>
<span class="sourceLineNo">137</span><a id="line.137">            case 49:</a>
<span class="sourceLineNo">138</span><a id="line.138">            case 50:</a>
<span class="sourceLineNo">139</span><a id="line.139">            case 51:</a>
<span class="sourceLineNo">140</span><a id="line.140">            case 52:</a>
<span class="sourceLineNo">141</span><a id="line.141">            case 53:</a>
<span class="sourceLineNo">142</span><a id="line.142">                return makeList("fresh water");</a>
<span class="sourceLineNo">143</span><a id="line.143">            case 54: //Ocean</a>
<span class="sourceLineNo">144</span><a id="line.144">            case 55:</a>
<span class="sourceLineNo">145</span><a id="line.145">            case 56:</a>
<span class="sourceLineNo">146</span><a id="line.146">            case 57:</a>
<span class="sourceLineNo">147</span><a id="line.147">            case 58:</a>
<span class="sourceLineNo">148</span><a id="line.148">            case 59:</a>
<span class="sourceLineNo">149</span><a id="line.149">                return makeList("salt water");</a>
<span class="sourceLineNo">150</span><a id="line.150">            case 3: //Desert</a>
<span class="sourceLineNo">151</span><a id="line.151">            case 4:</a>
<span class="sourceLineNo">152</span><a id="line.152">            case 5:</a>
<span class="sourceLineNo">153</span><a id="line.153">            case 10:</a>
<span class="sourceLineNo">154</span><a id="line.154">            case 11:</a>
<span class="sourceLineNo">155</span><a id="line.155">            case 17:</a>
<span class="sourceLineNo">156</span><a id="line.156">            case 38: //Beach</a>
<span class="sourceLineNo">157</span><a id="line.157">            case 39:</a>
<span class="sourceLineNo">158</span><a id="line.158">            case 40:</a>
<span class="sourceLineNo">159</span><a id="line.159">            case 41:</a>
<span class="sourceLineNo">160</span><a id="line.160">                return makeList("sand");</a>
<span class="sourceLineNo">161</span><a id="line.161">            case 2: //Grassland</a>
<span class="sourceLineNo">162</span><a id="line.162">            case 8:</a>
<span class="sourceLineNo">163</span><a id="line.163">            case 9:</a>
<span class="sourceLineNo">164</span><a id="line.164">                return makeShuffledRepeats(rng, "dirt", 8, "dry grass", 13, "grass", 2);</a>
<span class="sourceLineNo">165</span><a id="line.165">            case 14: //Woodland</a>
<span class="sourceLineNo">166</span><a id="line.166">            case 15:</a>
<span class="sourceLineNo">167</span><a id="line.167">                return makeShuffledRepeats(rng, "dirt", 11, "leaves", 3, "dry grass", 8);</a>
<span class="sourceLineNo">168</span><a id="line.168">            case 16: //Savanna</a>
<span class="sourceLineNo">169</span><a id="line.169">            case 22:</a>
<span class="sourceLineNo">170</span><a id="line.170">            case 23:</a>
<span class="sourceLineNo">171</span><a id="line.171">            case 29:</a>
<span class="sourceLineNo">172</span><a id="line.172">                return makeShuffledRepeats(rng, "dirt", 4, "dry grass", 17);</a>
<span class="sourceLineNo">173</span><a id="line.173">            case 20: //SeasonalForest</a>
<span class="sourceLineNo">174</span><a id="line.174">            case 21:</a>
<span class="sourceLineNo">175</span><a id="line.175">                return makeShuffledRepeats(rng, "dirt", 9, "leaves", 6, "grass", 14);</a>
<span class="sourceLineNo">176</span><a id="line.176">            case 27: //TemperateRainforest</a>
<span class="sourceLineNo">177</span><a id="line.177">            case 33:</a>
<span class="sourceLineNo">178</span><a id="line.178">                return makeShuffledRepeats(rng, "mud", 3, "leaves", 8, "grass", 10, "moss", 5);</a>
<span class="sourceLineNo">179</span><a id="line.179">            case 28: //TropicalRainforest</a>
<span class="sourceLineNo">180</span><a id="line.180">            case 34:</a>
<span class="sourceLineNo">181</span><a id="line.181">            case 35:</a>
<span class="sourceLineNo">182</span><a id="line.182">                return makeShuffledRepeats(rng, "mud", 7, "leaves", 6, "grass", 4, "moss", 11);</a>
<span class="sourceLineNo">183</span><a id="line.183">            case 36: // Rocky</a>
<span class="sourceLineNo">184</span><a id="line.184">            case 37:</a>
<span class="sourceLineNo">185</span><a id="line.185">                return makeShuffledRepeats(rng, "pebbles", 5, "rubble", 1);</a>
<span class="sourceLineNo">186</span><a id="line.186">            default:</a>
<span class="sourceLineNo">187</span><a id="line.187">                return makeList("empty space");</a>
<span class="sourceLineNo">188</span><a id="line.188">        }</a>
<span class="sourceLineNo">189</span><a id="line.189">    }</a>
<span class="sourceLineNo">190</span><a id="line.190">    /**</a>
<span class="sourceLineNo">191</span><a id="line.191">     * Gets a list of Strings that are really just the names of types of path tile for wilderness areas.</a>
<span class="sourceLineNo">192</span><a id="line.192">     * Not currently used.</a>
<span class="sourceLineNo">193</span><a id="line.193">     * @param biome an index into {@link squidpony.squidgrid.mapping.WorldMapGenerator.DetailedBiomeMapper#biomeTable}, or some other index if you don't use DetailedBiomeMapper</a>
<span class="sourceLineNo">194</span><a id="line.194">     * @return an ArrayList that typically contains just the one or few types of path that can appear here</a>
<span class="sourceLineNo">195</span><a id="line.195">     */</a>
<span class="sourceLineNo">196</span><a id="line.196">    public static ArrayList&lt;String&gt; pathsByBiome(int biome) {</a>
<span class="sourceLineNo">197</span><a id="line.197">        biome &amp;= 1023;</a>
<span class="sourceLineNo">198</span><a id="line.198">        switch (biome) {</a>
<span class="sourceLineNo">199</span><a id="line.199">            case 0: //Ice</a>
<span class="sourceLineNo">200</span><a id="line.200">            case 1:</a>
<span class="sourceLineNo">201</span><a id="line.201">            case 6:</a>
<span class="sourceLineNo">202</span><a id="line.202">            case 12:</a>
<span class="sourceLineNo">203</span><a id="line.203">            case 18:</a>
<span class="sourceLineNo">204</span><a id="line.204">            case 24:</a>
<span class="sourceLineNo">205</span><a id="line.205">            case 30:</a>
<span class="sourceLineNo">206</span><a id="line.206">            case 42:</a>
<span class="sourceLineNo">207</span><a id="line.207">            case 48:</a>
<span class="sourceLineNo">208</span><a id="line.208">                return makeList("snow path");</a>
<span class="sourceLineNo">209</span><a id="line.209">            case 7: //Tundra</a>
<span class="sourceLineNo">210</span><a id="line.210">            case 13:</a>
<span class="sourceLineNo">211</span><a id="line.211">            case 19:</a>
<span class="sourceLineNo">212</span><a id="line.212">            case 25: </a>
<span class="sourceLineNo">213</span><a id="line.213">            case 26: //BorealForest</a>
<span class="sourceLineNo">214</span><a id="line.214">            case 31:</a>
<span class="sourceLineNo">215</span><a id="line.215">            case 32:</a>
<span class="sourceLineNo">216</span><a id="line.216">                return makeList("snow path", "dirt path");</a>
<span class="sourceLineNo">217</span><a id="line.217">//            case 43: //River</a>
<span class="sourceLineNo">218</span><a id="line.218">//            case 44:</a>
<span class="sourceLineNo">219</span><a id="line.219">//            case 45:</a>
<span class="sourceLineNo">220</span><a id="line.220">//            case 46:</a>
<span class="sourceLineNo">221</span><a id="line.221">//            case 47:</a>
<span class="sourceLineNo">222</span><a id="line.222">//            case 49:</a>
<span class="sourceLineNo">223</span><a id="line.223">//            case 50:</a>
<span class="sourceLineNo">224</span><a id="line.224">//            case 51:</a>
<span class="sourceLineNo">225</span><a id="line.225">//            case 52:</a>
<span class="sourceLineNo">226</span><a id="line.226">//            case 53:</a>
<span class="sourceLineNo">227</span><a id="line.227">//            case 54: //Ocean</a>
<span class="sourceLineNo">228</span><a id="line.228">//            case 55:</a>
<span class="sourceLineNo">229</span><a id="line.229">//            case 56:</a>
<span class="sourceLineNo">230</span><a id="line.230">//            case 57:</a>
<span class="sourceLineNo">231</span><a id="line.231">//            case 58:</a>
<span class="sourceLineNo">232</span><a id="line.232">//            case 59:</a>
<span class="sourceLineNo">233</span><a id="line.233">//                return makeList("wooden bridge");</a>
<span class="sourceLineNo">234</span><a id="line.234">            case 3: //Desert</a>
<span class="sourceLineNo">235</span><a id="line.235">            case 4:</a>
<span class="sourceLineNo">236</span><a id="line.236">            case 5:</a>
<span class="sourceLineNo">237</span><a id="line.237">            case 10:</a>
<span class="sourceLineNo">238</span><a id="line.238">            case 11:</a>
<span class="sourceLineNo">239</span><a id="line.239">            case 17:</a>
<span class="sourceLineNo">240</span><a id="line.240">            case 38: //Beach</a>
<span class="sourceLineNo">241</span><a id="line.241">            case 39:</a>
<span class="sourceLineNo">242</span><a id="line.242">            case 40:</a>
<span class="sourceLineNo">243</span><a id="line.243">            case 41:</a>
<span class="sourceLineNo">244</span><a id="line.244">                return makeList("sand path");</a>
<span class="sourceLineNo">245</span><a id="line.245">            case 2: //Grassland</a>
<span class="sourceLineNo">246</span><a id="line.246">            case 8:</a>
<span class="sourceLineNo">247</span><a id="line.247">            case 9:</a>
<span class="sourceLineNo">248</span><a id="line.248">            case 14: //Woodland</a>
<span class="sourceLineNo">249</span><a id="line.249">            case 15:</a>
<span class="sourceLineNo">250</span><a id="line.250">            case 16: //Savanna</a>
<span class="sourceLineNo">251</span><a id="line.251">            case 22:</a>
<span class="sourceLineNo">252</span><a id="line.252">            case 23:</a>
<span class="sourceLineNo">253</span><a id="line.253">            case 29:</a>
<span class="sourceLineNo">254</span><a id="line.254">                return makeList("dirt path");</a>
<span class="sourceLineNo">255</span><a id="line.255">            case 20: //SeasonalForest</a>
<span class="sourceLineNo">256</span><a id="line.256">            case 21:</a>
<span class="sourceLineNo">257</span><a id="line.257">                return makeList("dirt path", "grass path");</a>
<span class="sourceLineNo">258</span><a id="line.258">            case 27: //TemperateRainforest</a>
<span class="sourceLineNo">259</span><a id="line.259">            case 33:</a>
<span class="sourceLineNo">260</span><a id="line.260">            case 28: //TropicalRainforest</a>
<span class="sourceLineNo">261</span><a id="line.261">            case 34:</a>
<span class="sourceLineNo">262</span><a id="line.262">            case 35:</a>
<span class="sourceLineNo">263</span><a id="line.263">                return makeList("grass path");</a>
<span class="sourceLineNo">264</span><a id="line.264">            case 36: // Rocky</a>
<span class="sourceLineNo">265</span><a id="line.265">            case 37:</a>
<span class="sourceLineNo">266</span><a id="line.266">                return makeList("stone path");</a>
<span class="sourceLineNo">267</span><a id="line.267">            default:</a>
<span class="sourceLineNo">268</span><a id="line.268">                return makeList("wooden bridge");</a>
<span class="sourceLineNo">269</span><a id="line.269"></a>
<span class="sourceLineNo">270</span><a id="line.270">        }</a>
<span class="sourceLineNo">271</span><a id="line.271">    }</a>
<span class="sourceLineNo">272</span><a id="line.272">    /**</a>
<span class="sourceLineNo">273</span><a id="line.273">     * Gets a list of Strings that are really just the names of types of terrain feature for wilderness areas.</a>
<span class="sourceLineNo">274</span><a id="line.274">     * @param biome an index into {@link squidpony.squidgrid.mapping.WorldMapGenerator.DetailedBiomeMapper#biomeTable}, or some other index if you don't use DetailedBiomeMapper</a>
<span class="sourceLineNo">275</span><a id="line.275">     * @param rng an IRNG, like {@link squidpony.squidmath.RNG} or {@link squidpony.squidmath.GWTRNG}</a>
<span class="sourceLineNo">276</span><a id="line.276">     * @return a shuffled ArrayList that typically contains repeats of the kinds of terrain feature that can appear here</a>
<span class="sourceLineNo">277</span><a id="line.277">     */</a>
<span class="sourceLineNo">278</span><a id="line.278">    public static ArrayList&lt;String&gt; contentByBiome(int biome, IRNG rng) {</a>
<span class="sourceLineNo">279</span><a id="line.279">        biome &amp;= 1023;</a>
<span class="sourceLineNo">280</span><a id="line.280">        switch (biome) {</a>
<span class="sourceLineNo">281</span><a id="line.281">            case 0: //Ice</a>
<span class="sourceLineNo">282</span><a id="line.282">            case 1:</a>
<span class="sourceLineNo">283</span><a id="line.283">            case 6:</a>
<span class="sourceLineNo">284</span><a id="line.284">            case 12:</a>
<span class="sourceLineNo">285</span><a id="line.285">            case 18:</a>
<span class="sourceLineNo">286</span><a id="line.286">            case 24:</a>
<span class="sourceLineNo">287</span><a id="line.287">            case 30:</a>
<span class="sourceLineNo">288</span><a id="line.288">            case 42:</a>
<span class="sourceLineNo">289</span><a id="line.289">            case 48:</a>
<span class="sourceLineNo">290</span><a id="line.290">                return makeShuffledRepeats(rng, "snow mound", 5, "icy divot", 2, "powder snowdrift", 5);</a>
<span class="sourceLineNo">291</span><a id="line.291">            case 7: //Tundra</a>
<span class="sourceLineNo">292</span><a id="line.292">            case 13:</a>
<span class="sourceLineNo">293</span><a id="line.293">            case 19:</a>
<span class="sourceLineNo">294</span><a id="line.294">            case 25:</a>
<span class="sourceLineNo">295</span><a id="line.295">                return makeShuffledRepeats(rng, "snow mound", 4, "hillock", 6, "animal burrow", 5, "small bush 1", 2);</a>
<span class="sourceLineNo">296</span><a id="line.296">            case 26: //BorealForest</a>
<span class="sourceLineNo">297</span><a id="line.297">            case 31:</a>
<span class="sourceLineNo">298</span><a id="line.298">            case 32:</a>
<span class="sourceLineNo">299</span><a id="line.299">                return makeShuffledRepeats(rng, "snow mound", 3, "small bush 1", 5, "large bush 1", 3, "evergreen tree 1", 17, "evergreen tree 2", 12);</a>
<span class="sourceLineNo">300</span><a id="line.300">//                case 43: //River</a>
<span class="sourceLineNo">301</span><a id="line.301">//                case 44:</a>
<span class="sourceLineNo">302</span><a id="line.302">//                case 45:</a>
<span class="sourceLineNo">303</span><a id="line.303">//                case 46:</a>
<span class="sourceLineNo">304</span><a id="line.304">//                case 47:</a>
<span class="sourceLineNo">305</span><a id="line.305">//                case 49:</a>
<span class="sourceLineNo">306</span><a id="line.306">//                case 50:</a>
<span class="sourceLineNo">307</span><a id="line.307">//                case 51:</a>
<span class="sourceLineNo">308</span><a id="line.308">//                case 52:</a>
<span class="sourceLineNo">309</span><a id="line.309">//                case 53:</a>
<span class="sourceLineNo">310</span><a id="line.310">//                case 54: //Ocean</a>
<span class="sourceLineNo">311</span><a id="line.311">//                case 55:</a>
<span class="sourceLineNo">312</span><a id="line.312">//                case 56:</a>
<span class="sourceLineNo">313</span><a id="line.313">//                case 57:</a>
<span class="sourceLineNo">314</span><a id="line.314">//                case 58:</a>
<span class="sourceLineNo">315</span><a id="line.315">//                case 59:</a>
<span class="sourceLineNo">316</span><a id="line.316">//                    return new ArrayList&lt;&gt;(0);</a>
<span class="sourceLineNo">317</span><a id="line.317">            case 3: //Desert</a>
<span class="sourceLineNo">318</span><a id="line.318">            case 4:</a>
<span class="sourceLineNo">319</span><a id="line.319">            case 5:</a>
<span class="sourceLineNo">320</span><a id="line.320">            case 10:</a>
<span class="sourceLineNo">321</span><a id="line.321">            case 11:</a>
<span class="sourceLineNo">322</span><a id="line.322">            case 17:</a>
<span class="sourceLineNo">323</span><a id="line.323">                return makeShuffledRepeats(rng, "small cactus 1", 2, "large cactus 1", 2, "succulent 1", 1, "animal burrow", 2);</a>
<span class="sourceLineNo">324</span><a id="line.324">            case 38: //Beach</a>
<span class="sourceLineNo">325</span><a id="line.325">            case 39:</a>
<span class="sourceLineNo">326</span><a id="line.326">            case 40:</a>
<span class="sourceLineNo">327</span><a id="line.327">            case 41:</a>
<span class="sourceLineNo">328</span><a id="line.328">                return makeShuffledRepeats(rng, "seashell 1", 3, "seashell 2", 3, "seashell 3", 3, "seashell 4", 3, "driftwood", 5, "boulder", 3);</a>
<span class="sourceLineNo">329</span><a id="line.329">            case 2: //Grassland</a>
<span class="sourceLineNo">330</span><a id="line.330">            case 8:</a>
<span class="sourceLineNo">331</span><a id="line.331">            case 9:</a>
<span class="sourceLineNo">332</span><a id="line.332">                return makeShuffledRepeats(rng, "deciduous tree 1", 3, "small bush 1", 5, "small bush 2", 4, "large bush 1", 5, "animal burrow", 8, "hillock", 4);</a>
<span class="sourceLineNo">333</span><a id="line.333">            case 14: //Woodland</a>
<span class="sourceLineNo">334</span><a id="line.334">            case 15:</a>
<span class="sourceLineNo">335</span><a id="line.335">                return makeShuffledRepeats(rng, "deciduous tree 1", 12, "deciduous tree 2", 9, "deciduous tree 3", 6, "small bush 1", 4, "small bush 2", 3, "animal burrow", 3);</a>
<span class="sourceLineNo">336</span><a id="line.336">            case 16: //Savanna</a>
<span class="sourceLineNo">337</span><a id="line.337">            case 22:</a>
<span class="sourceLineNo">338</span><a id="line.338">            case 23:</a>
<span class="sourceLineNo">339</span><a id="line.339">            case 29:</a>
<span class="sourceLineNo">340</span><a id="line.340">                return makeShuffledRepeats(rng, "small bush 1", 8, "small bush 2", 5, "large bush 1", 2, "animal burrow", 3, "hillock", 6);</a>
<span class="sourceLineNo">341</span><a id="line.341">            case 20: //SeasonalForest</a>
<span class="sourceLineNo">342</span><a id="line.342">            case 21:</a>
<span class="sourceLineNo">343</span><a id="line.343">                return makeShuffledRepeats(rng, "deciduous tree 1", 15, "deciduous tree 2", 13, "deciduous tree 3", 12, "small bush 1", 3, "large bush 1", 5, "large bush 2", 4, "animal burrow", 3);</a>
<span class="sourceLineNo">344</span><a id="line.344">            case 27: //TemperateRainforest</a>
<span class="sourceLineNo">345</span><a id="line.345">            case 33:</a>
<span class="sourceLineNo">346</span><a id="line.346">                return makeShuffledRepeats(rng, "tropical tree 1", 6, "tropical tree 2", 5, "deciduous tree 1", 13, "deciduous tree 2", 12, "small bush 1", 8, "large bush 1", 7, "large bush 2", 7, "large bush 3", 3, "animal burrow", 3);</a>
<span class="sourceLineNo">347</span><a id="line.347">            case 28: //TropicalRainforest</a>
<span class="sourceLineNo">348</span><a id="line.348">            case 34:</a>
<span class="sourceLineNo">349</span><a id="line.349">            case 35:</a>
<span class="sourceLineNo">350</span><a id="line.350">                return makeShuffledRepeats(rng, "tropical tree 1", 12, "tropical tree 2", 11, "tropical tree 3", 10, "tropical tree 4", 9, "small bush 1", 6, "small bush 2", 5, "large bush 1", 6, "large bush 2", 5, "large bush 3", 3, "animal burrow", 9, "boulder", 1);</a>
<span class="sourceLineNo">351</span><a id="line.351">            case 36: // Rocky</a>
<span class="sourceLineNo">352</span><a id="line.352">            case 37:</a>
<span class="sourceLineNo">353</span><a id="line.353">                return makeShuffledRepeats(rng, "seashell 1", 3, "seashell 2", 2, "seashell 3", 2, "driftwood", 6, "boulder", 9);</a>
<span class="sourceLineNo">354</span><a id="line.354">            default:</a>
<span class="sourceLineNo">355</span><a id="line.355">                return new ArrayList&lt;&gt;(0);</a>
<span class="sourceLineNo">356</span><a id="line.356">        }</a>
<span class="sourceLineNo">357</span><a id="line.357">    }</a>
<span class="sourceLineNo">358</span><a id="line.358">//                //COLDEST //COLDER        //COLD            //HOT                  //HOTTER              //HOTTEST</a>
<span class="sourceLineNo">359</span><a id="line.359">//                "Ice",    "Ice",          "Grassland",      "Desert",              "Desert",             "Desert",             //DRYEST</a>
<span class="sourceLineNo">360</span><a id="line.360">//                "Ice",    "Tundra",       "Grassland",      "Grassland",           "Desert",             "Desert",             //DRYER</a>
<span class="sourceLineNo">361</span><a id="line.361">//                "Ice",    "Tundra",       "Woodland",       "Woodland",            "Savanna",            "Desert",             //DRY</a>
<span class="sourceLineNo">362</span><a id="line.362">//                "Ice",    "Tundra",       "SeasonalForest", "SeasonalForest",      "Savanna",            "Savanna",            //WET</a>
<span class="sourceLineNo">363</span><a id="line.363">//                "Ice",    "Tundra",       "BorealForest",   "TemperateRainforest", "TropicalRainforest", "Savanna",            //WETTER</a>
<span class="sourceLineNo">364</span><a id="line.364">//                "Ice",    "BorealForest", "BorealForest",   "TemperateRainforest", "TropicalRainforest", "TropicalRainforest", //WETTEST</a>
<span class="sourceLineNo">365</span><a id="line.365">//                "Rocky",  "Rocky",        "Beach",          "Beach",               "Beach",              "Beach",              //COASTS</a>
<span class="sourceLineNo">366</span><a id="line.366">//                "Ice",    "River",        "River",          "River",               "River",              "River",              //RIVERS</a>
<span class="sourceLineNo">367</span><a id="line.367">//                "Ice",    "River",        "River",          "River",               "River",              "River",              //LAKES</a>
<span class="sourceLineNo">368</span><a id="line.368">//                "Ocean",  "Ocean",        "Ocean",          "Ocean",               "Ocean",              "Ocean",              //OCEAN</a>
<span class="sourceLineNo">369</span><a id="line.369">//                "Empty",                                                                                                       //SPACE</a>
<span class="sourceLineNo">370</span><a id="line.370">    </a>
<span class="sourceLineNo">371</span><a id="line.371">    public WildMap()</a>
<span class="sourceLineNo">372</span><a id="line.372">    {</a>
<span class="sourceLineNo">373</span><a id="line.373">        this(128, 128, 21);</a>
<span class="sourceLineNo">374</span><a id="line.374">    }</a>
<span class="sourceLineNo">375</span><a id="line.375">    public WildMap(int width, int height, int biome)</a>
<span class="sourceLineNo">376</span><a id="line.376">    {</a>
<span class="sourceLineNo">377</span><a id="line.377">        this(width, height, biome, new SilkRNG());</a>
<span class="sourceLineNo">378</span><a id="line.378">    }</a>
<span class="sourceLineNo">379</span><a id="line.379">    public WildMap(int width, int height, int biome, int seedA, int seedB)</a>
<span class="sourceLineNo">380</span><a id="line.380">    {</a>
<span class="sourceLineNo">381</span><a id="line.381">        this(width, height, biome, new SilkRNG(seedA, seedB));</a>
<span class="sourceLineNo">382</span><a id="line.382">    }</a>
<span class="sourceLineNo">383</span><a id="line.383">    public WildMap(int width, int height, int biome, IStatefulRNG rng)</a>
<span class="sourceLineNo">384</span><a id="line.384">    {</a>
<span class="sourceLineNo">385</span><a id="line.385">        this(width, height, biome, rng, floorsByBiome(biome, rng), contentByBiome(biome, rng));</a>
<span class="sourceLineNo">386</span><a id="line.386">    }</a>
<span class="sourceLineNo">387</span><a id="line.387">    public WildMap(int width, int height, int biome, IStatefulRNG rng, ArrayList&lt;String&gt; contentTypes)</a>
<span class="sourceLineNo">388</span><a id="line.388">    {</a>
<span class="sourceLineNo">389</span><a id="line.389">        this(width, height, biome, rng, floorsByBiome(biome, rng), contentTypes);</a>
<span class="sourceLineNo">390</span><a id="line.390">    }</a>
<span class="sourceLineNo">391</span><a id="line.391">    public WildMap(int width, int height, int biome, IStatefulRNG rng, ArrayList&lt;String&gt; floorTypes, ArrayList&lt;String&gt; contentTypes)</a>
<span class="sourceLineNo">392</span><a id="line.392">    {</a>
<span class="sourceLineNo">393</span><a id="line.393">        this.width = width;</a>
<span class="sourceLineNo">394</span><a id="line.394">        this.height = height;</a>
<span class="sourceLineNo">395</span><a id="line.395">        this.biome = biome;</a>
<span class="sourceLineNo">396</span><a id="line.396">        this.rng = rng;</a>
<span class="sourceLineNo">397</span><a id="line.397">        content = ArrayTools.fill(-1, width, height);</a>
<span class="sourceLineNo">398</span><a id="line.398">        floors = new int[width][height];</a>
<span class="sourceLineNo">399</span><a id="line.399">        this.floorTypes = floorTypes;</a>
<span class="sourceLineNo">400</span><a id="line.400">        this.contentTypes = contentTypes;</a>
<span class="sourceLineNo">401</span><a id="line.401">    }</a>
<span class="sourceLineNo">402</span><a id="line.402"></a>
<span class="sourceLineNo">403</span><a id="line.403">    /**</a>
<span class="sourceLineNo">404</span><a id="line.404">     * Produces a map by filling the {@link #floors} 2D array with indices into {@link #floorTypes}, and similarly</a>
<span class="sourceLineNo">405</span><a id="line.405">     * filling the {@link #content} 2D array with indices into {@link #contentTypes}. You only need to call this method</a>
<span class="sourceLineNo">406</span><a id="line.406">     * when you first generate a map with the specific parameters you want, such as biome, and later if you want another</a>
<span class="sourceLineNo">407</span><a id="line.407">     * map with the same parameters.</a>
<span class="sourceLineNo">408</span><a id="line.408">     * &lt;br&gt;</a>
<span class="sourceLineNo">409</span><a id="line.409">     * Virtually all of this method is a wrapper around functionality provided by {@link BlueNoise}, adjusted to fit</a>
<span class="sourceLineNo">410</span><a id="line.410">     * wilderness maps slightly.</a>
<span class="sourceLineNo">411</span><a id="line.411">     */</a>
<span class="sourceLineNo">412</span><a id="line.412">    public void generate() {</a>
<span class="sourceLineNo">413</span><a id="line.413">        ArrayTools.fill(content, -1);</a>
<span class="sourceLineNo">414</span><a id="line.414">        final int seed = rng.nextInt();//, otherSeed = rng.nextInt(), choice = seed + otherSeed &amp; 15;</a>
<span class="sourceLineNo">415</span><a id="line.415">        final int limit = contentTypes.size(), floorLimit = floorTypes.size();</a>
<span class="sourceLineNo">416</span><a id="line.416">        int b;</a>
<span class="sourceLineNo">417</span><a id="line.417">        BlueNoise.blueSpill(floors, floorLimit, rng);</a>
<span class="sourceLineNo">418</span><a id="line.418">        for (int x = 0; x &lt; width; x++) {</a>
<span class="sourceLineNo">419</span><a id="line.419">            for (int y = 0; y &lt; height; y++) {</a>
<span class="sourceLineNo">420</span><a id="line.420">                if((b = BlueNoise.getChosen(x, y, seed) + 128) &lt; limit)</a>
<span class="sourceLineNo">421</span><a id="line.421">                    content[x][y] = b;</a>
<span class="sourceLineNo">422</span><a id="line.422">                //floors[x][y] = (int)((FastNoise.instance.layered2D(x,  y, otherSeed, 2, 0x1p-5f) * 0.4999f + 0.5f) * (floorLimit - 1) + 0.25f + rng.nextFloat(0.5f));</a>
<span class="sourceLineNo">423</span><a id="line.423">            }</a>
<span class="sourceLineNo">424</span><a id="line.424">        }</a>
<span class="sourceLineNo">425</span><a id="line.425">    }</a>
<span class="sourceLineNo">426</span><a id="line.426"></a>
<span class="sourceLineNo">427</span><a id="line.427">    /**</a>
<span class="sourceLineNo">428</span><a id="line.428">     * A subclass of {@link WildMap} that serves as a ragged edge between 2, 3, or 4 WildMaps in a square intersection.</a>
<span class="sourceLineNo">429</span><a id="line.429">     * You almost always supply 4 WildMaps to this (typically not other MixedWildMaps), one for each corner of the map,</a>
<span class="sourceLineNo">430</span><a id="line.430">     * and this generates an uneven border between them. Make sure to look up the indices in the {@link #content} and</a>
<span class="sourceLineNo">431</span><a id="line.431">     * {@link #floors} using this MixedWildMap's {@link #contentTypes} and {@link #floorTypes}, not the ones in the</a>
<span class="sourceLineNo">432</span><a id="line.432">     * inner WildMaps, because the indices in the MixedWildMap are different.</a>
<span class="sourceLineNo">433</span><a id="line.433">     */</a>
<span class="sourceLineNo">434</span><a id="line.434">    public static class MixedWildMap extends WildMap implements Serializable</a>
<span class="sourceLineNo">435</span><a id="line.435">    {</a>
<span class="sourceLineNo">436</span><a id="line.436">        private static final long serialVersionUID = 1L;</a>
<span class="sourceLineNo">437</span><a id="line.437">        public final int[][] pieceMap;</a>
<span class="sourceLineNo">438</span><a id="line.438">        public final WildMap[] pieces;</a>
<span class="sourceLineNo">439</span><a id="line.439">        protected final int[] minFloors, maxFloors, minContents, maxContents;</a>
<span class="sourceLineNo">440</span><a id="line.440">        </a>
<span class="sourceLineNo">441</span><a id="line.441">        public MixedWildMap()</a>
<span class="sourceLineNo">442</span><a id="line.442">        {</a>
<span class="sourceLineNo">443</span><a id="line.443">            this(new WildMap(), new WildMap(), new WildMap(), new WildMap(), new SilkRNG());</a>
<span class="sourceLineNo">444</span><a id="line.444">        }</a>
<span class="sourceLineNo">445</span><a id="line.445">        </a>
<span class="sourceLineNo">446</span><a id="line.446">        public MixedWildMap(WildMap northeast, WildMap southeast, WildMap southwest, WildMap northwest, IStatefulRNG rng)</a>
<span class="sourceLineNo">447</span><a id="line.447">        {</a>
<span class="sourceLineNo">448</span><a id="line.448">            super(northeast.width, northeast.height, northeast.biome, rng, new ArrayList&lt;&gt;(northeast.floorTypes), new ArrayList&lt;&gt;(northeast.contentTypes));</a>
<span class="sourceLineNo">449</span><a id="line.449">            minFloors = new int[4];</a>
<span class="sourceLineNo">450</span><a id="line.450">            maxFloors = new int[4];</a>
<span class="sourceLineNo">451</span><a id="line.451">            minContents = new int[4];</a>
<span class="sourceLineNo">452</span><a id="line.452">            maxContents = new int[4];</a>
<span class="sourceLineNo">453</span><a id="line.453">            floorTypes.addAll(southeast.floorTypes);</a>
<span class="sourceLineNo">454</span><a id="line.454">            floorTypes.addAll(southwest.floorTypes);</a>
<span class="sourceLineNo">455</span><a id="line.455">            floorTypes.addAll(northwest.floorTypes);</a>
<span class="sourceLineNo">456</span><a id="line.456">            contentTypes.addAll(southeast.contentTypes);</a>
<span class="sourceLineNo">457</span><a id="line.457">            contentTypes.addAll(southwest.contentTypes);</a>
<span class="sourceLineNo">458</span><a id="line.458">            contentTypes.addAll(northwest.contentTypes);</a>
<span class="sourceLineNo">459</span><a id="line.459">            minFloors[1]   = maxFloors[0]   = northeast.floorTypes.size();</a>
<span class="sourceLineNo">460</span><a id="line.460">            minContents[1] = maxContents[0] = northeast.contentTypes.size();</a>
<span class="sourceLineNo">461</span><a id="line.461">            minFloors[2]   = maxFloors[1]   = maxFloors[0]    + southeast.floorTypes.size();</a>
<span class="sourceLineNo">462</span><a id="line.462">            minContents[2] = maxContents[1] = maxContents[0]  + southeast.contentTypes.size();</a>
<span class="sourceLineNo">463</span><a id="line.463">            minFloors[3]   = maxFloors[2]   = maxFloors[1]    + southwest.floorTypes.size();</a>
<span class="sourceLineNo">464</span><a id="line.464">            minContents[3] = maxContents[2] = maxContents[1]  + southwest.contentTypes.size();</a>
<span class="sourceLineNo">465</span><a id="line.465">            maxFloors[3]   = maxFloors[2]    + northwest.floorTypes.size();</a>
<span class="sourceLineNo">466</span><a id="line.466">            maxContents[3] = maxContents[2]  + northwest.contentTypes.size();</a>
<span class="sourceLineNo">467</span><a id="line.467">            pieces = new WildMap[]{northeast, southeast, southwest, northwest};</a>
<span class="sourceLineNo">468</span><a id="line.468">            pieceMap = new int[width][height];</a>
<span class="sourceLineNo">469</span><a id="line.469">        }</a>
<span class="sourceLineNo">470</span><a id="line.470">        </a>
<span class="sourceLineNo">471</span><a id="line.471">        protected void preparePieceMap()</a>
<span class="sourceLineNo">472</span><a id="line.472">        {</a>
<span class="sourceLineNo">473</span><a id="line.473">            ArrayTools.fill(pieceMap, 255);</a>
<span class="sourceLineNo">474</span><a id="line.474">            pieceMap[width - 1][0] = 0; // northeast</a>
<span class="sourceLineNo">475</span><a id="line.475">            pieceMap[width - 1][height - 1] = 1; // southeast</a>
<span class="sourceLineNo">476</span><a id="line.476">            pieceMap[0][height - 1] = 2; // southwest</a>
<span class="sourceLineNo">477</span><a id="line.477">            pieceMap[0][0] = 3; //northwest</a>
<span class="sourceLineNo">478</span><a id="line.478">            final int spillerLimit = 4;</a>
<span class="sourceLineNo">479</span><a id="line.479">            final Direction[] dirs = Direction.CARDINALS;</a>
<span class="sourceLineNo">480</span><a id="line.480">            Direction d;</a>
<span class="sourceLineNo">481</span><a id="line.481">            int t, rx, ry, ctr;</a>
<span class="sourceLineNo">482</span><a id="line.482">            int[] ox = new int[width], oy = new int[height];</a>
<span class="sourceLineNo">483</span><a id="line.483">            boolean anySuccesses = false;</a>
<span class="sourceLineNo">484</span><a id="line.484">            do {</a>
<span class="sourceLineNo">485</span><a id="line.485">                ctr = 0;</a>
<span class="sourceLineNo">486</span><a id="line.486">                rng.randomOrdering(width, ox);</a>
<span class="sourceLineNo">487</span><a id="line.487">                rng.randomOrdering(height, oy);</a>
<span class="sourceLineNo">488</span><a id="line.488">                for (int x = 0; x &lt; width; x++) {</a>
<span class="sourceLineNo">489</span><a id="line.489">                    rx = ox[x];</a>
<span class="sourceLineNo">490</span><a id="line.490">                    for (int y = 0; y &lt; height; y++) {</a>
<span class="sourceLineNo">491</span><a id="line.491">                        ry = oy[y];</a>
<span class="sourceLineNo">492</span><a id="line.492">                        if ((t = pieceMap[rx][ry]) &lt; spillerLimit) {</a>
<span class="sourceLineNo">493</span><a id="line.493">                            d = dirs[rng.next(2)];</a>
<span class="sourceLineNo">494</span><a id="line.494">                            if (rx + d.deltaX &gt;= 0 &amp;&amp; rx + d.deltaX &lt; width &amp;&amp; ry + d.deltaY &gt;= 0 &amp;&amp; ry + d.deltaY &lt; height &amp;&amp;</a>
<span class="sourceLineNo">495</span><a id="line.495">                                    pieceMap[rx + d.deltaX][ry + d.deltaY] &gt;= spillerLimit) {</a>
<span class="sourceLineNo">496</span><a id="line.496">                                pieceMap[rx + d.deltaX][ry + d.deltaY] = t;</a>
<span class="sourceLineNo">497</span><a id="line.497">                                ctr++;</a>
<span class="sourceLineNo">498</span><a id="line.498">                            }</a>
<span class="sourceLineNo">499</span><a id="line.499">                            d = dirs[rng.next(2)];</a>
<span class="sourceLineNo">500</span><a id="line.500">                            if (rx + d.deltaX &gt;= 0 &amp;&amp; rx + d.deltaX &lt; width &amp;&amp; ry + d.deltaY &gt;= 0 &amp;&amp; ry + d.deltaY &lt; height &amp;&amp;</a>
<span class="sourceLineNo">501</span><a id="line.501">                                    pieceMap[rx + d.deltaX][ry + d.deltaY] &gt;= spillerLimit) {</a>
<span class="sourceLineNo">502</span><a id="line.502">                                pieceMap[rx + d.deltaX][ry + d.deltaY] = t;</a>
<span class="sourceLineNo">503</span><a id="line.503">                                ctr++;</a>
<span class="sourceLineNo">504</span><a id="line.504">                            }</a>
<span class="sourceLineNo">505</span><a id="line.505">                        }</a>
<span class="sourceLineNo">506</span><a id="line.506"></a>
<span class="sourceLineNo">507</span><a id="line.507">                    }</a>
<span class="sourceLineNo">508</span><a id="line.508">                }</a>
<span class="sourceLineNo">509</span><a id="line.509">                if(!anySuccesses &amp;&amp; ctr == 0)</a>
<span class="sourceLineNo">510</span><a id="line.510">                {</a>
<span class="sourceLineNo">511</span><a id="line.511">                    ArrayTools.fill(pieceMap, 0);</a>
<span class="sourceLineNo">512</span><a id="line.512">                    return;</a>
<span class="sourceLineNo">513</span><a id="line.513">                }</a>
<span class="sourceLineNo">514</span><a id="line.514">                else</a>
<span class="sourceLineNo">515</span><a id="line.515">                    anySuccesses = true;</a>
<span class="sourceLineNo">516</span><a id="line.516">            } while (ctr &gt; 0);</a>
<span class="sourceLineNo">517</span><a id="line.517">            do {</a>
<span class="sourceLineNo">518</span><a id="line.518">                ctr = 0;</a>
<span class="sourceLineNo">519</span><a id="line.519">                rng.randomOrdering(width, ox);</a>
<span class="sourceLineNo">520</span><a id="line.520">                rng.randomOrdering(height, oy);</a>
<span class="sourceLineNo">521</span><a id="line.521">                for (int x = 0; x &lt; width; x++) {</a>
<span class="sourceLineNo">522</span><a id="line.522">                    rx = ox[x];</a>
<span class="sourceLineNo">523</span><a id="line.523">                    for (int y = 0; y &lt; height; y++) {</a>
<span class="sourceLineNo">524</span><a id="line.524">                        ry = oy[y];</a>
<span class="sourceLineNo">525</span><a id="line.525">                        if ((t = pieceMap[rx][ry]) &lt; spillerLimit) {</a>
<span class="sourceLineNo">526</span><a id="line.526">                            for (int i = 0; i &lt; 4; i++) {</a>
<span class="sourceLineNo">527</span><a id="line.527">                                d = dirs[i];</a>
<span class="sourceLineNo">528</span><a id="line.528">                                if (rx + d.deltaX &gt;= 0 &amp;&amp; rx + d.deltaX &lt; width &amp;&amp; ry + d.deltaY &gt;= 0 &amp;&amp; ry + d.deltaY &lt; height &amp;&amp;</a>
<span class="sourceLineNo">529</span><a id="line.529">                                        pieceMap[rx + d.deltaX][ry + d.deltaY] &gt;= spillerLimit) {</a>
<span class="sourceLineNo">530</span><a id="line.530">                                    pieceMap[rx + d.deltaX][ry + d.deltaY] = t;</a>
<span class="sourceLineNo">531</span><a id="line.531">                                    ctr++;</a>
<span class="sourceLineNo">532</span><a id="line.532">                                }</a>
<span class="sourceLineNo">533</span><a id="line.533">                            }</a>
<span class="sourceLineNo">534</span><a id="line.534">                        }</a>
<span class="sourceLineNo">535</span><a id="line.535"></a>
<span class="sourceLineNo">536</span><a id="line.536">                    }</a>
<span class="sourceLineNo">537</span><a id="line.537">                }</a>
<span class="sourceLineNo">538</span><a id="line.538">            } while (ctr &gt; 0);</a>
<span class="sourceLineNo">539</span><a id="line.539"></a>
<span class="sourceLineNo">540</span><a id="line.540">        }</a>
<span class="sourceLineNo">541</span><a id="line.541"></a>
<span class="sourceLineNo">542</span><a id="line.542">        @Override</a>
<span class="sourceLineNo">543</span><a id="line.543">        public void generate() {</a>
<span class="sourceLineNo">544</span><a id="line.544">            ArrayTools.fill(content, -1);</a>
<span class="sourceLineNo">545</span><a id="line.545">            for (int i = 0; i &lt; pieces.length; i++) {</a>
<span class="sourceLineNo">546</span><a id="line.546">                pieces[i].generate();</a>
<span class="sourceLineNo">547</span><a id="line.547">            }</a>
<span class="sourceLineNo">548</span><a id="line.548">            preparePieceMap();</a>
<span class="sourceLineNo">549</span><a id="line.549">            int p, c;</a>
<span class="sourceLineNo">550</span><a id="line.550">            WildMap piece;</a>
<span class="sourceLineNo">551</span><a id="line.551">            for (int x = 0; x &lt; width; x++) {</a>
<span class="sourceLineNo">552</span><a id="line.552">                for (int y = 0; y &lt; height; y++) {</a>
<span class="sourceLineNo">553</span><a id="line.553">                    p = pieceMap[x][y];</a>
<span class="sourceLineNo">554</span><a id="line.554">                    piece = pieces[p];</a>
<span class="sourceLineNo">555</span><a id="line.555">                    floors[x][y] = piece.floors[x][y] + minFloors[p];</a>
<span class="sourceLineNo">556</span><a id="line.556">                    if((c = piece.content[x][y]) &gt;= 0)</a>
<span class="sourceLineNo">557</span><a id="line.557">                    {</a>
<span class="sourceLineNo">558</span><a id="line.558">                        content[x][y] = c + minContents[p];</a>
<span class="sourceLineNo">559</span><a id="line.559">                    }</a>
<span class="sourceLineNo">560</span><a id="line.560">                }</a>
<span class="sourceLineNo">561</span><a id="line.561">            }</a>
<span class="sourceLineNo">562</span><a id="line.562">        }</a>
<span class="sourceLineNo">563</span><a id="line.563">    }</a>
<span class="sourceLineNo">564</span><a id="line.564">}</a>




























































</pre>
</div>
</main>
</body>
</html>
